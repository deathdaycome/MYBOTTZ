# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Avito Webhook –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç

–í–º–µ—Å—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞ Avito API –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥, —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ webhook. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –∂–µ
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** - –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- ‚úÖ **–õ—É—á—à–∏–π UX** - –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚úÖ **–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```bash
# –í –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
./setup_webhook.sh
```

–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç `1` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook.

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook
python3 setup_avito_webhook.py setup

# –û—Ç–∫–ª—é—á–∏—Ç—å webhook (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python3 setup_avito_webhook.py unsubscribe

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å endpoint
python3 setup_avito_webhook.py test
```

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Avito
AVITO_CLIENT_ID=your_client_id
AVITO_CLIENT_SECRET=your_client_secret
AVITO_USER_ID=your_user_id

# –î–æ–º–µ–Ω –¥–ª—è webhook (–±–µ–∑ http/https)
DOMAIN=yourdomain.com
```

### –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

Webhook endpoint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```
https://yourdomain.com/admin/avito/webhook
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Å–µ–∫—É–Ω–¥, –∏–Ω–∞—á–µ Avito –æ—Ç–∫–ª—é—á–∏—Ç webhook.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

1. –°–∫—Ä–∏–ø—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç URL `https://yourdomain.com/admin/avito/webhook` –≤ Avito API
2. Avito –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å POST –∑–∞–ø—Ä–æ—Å—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
3. –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
4. Frontend –ø–æ–ª—É—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ webhook —Å–æ–±—ã—Ç–∏—è

```json
{
  "message": {
    "id": "msg_id",
    "chat_id": "chat_id", 
    "author_id": 12345,
    "content": {
      "text": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
    },
    "created": 1692808800,
    "type": "text"
  }
}
```

### Endpoints

- `POST /admin/avito/webhook` - –ü–æ–ª—É—á–µ–Ω–∏–µ webhook –æ—Ç Avito
- `GET /admin/avito/webhook/status` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook
- `WS /admin/avito/ws` - WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint:**
   ```bash
   curl -X POST https://yourdomain.com/admin/avito/webhook \
        -H "Content-Type: application/json" \
        -d '{"test": "message"}'
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   python3 -c "from app.config.settings import settings; print(f'Domain: {settings.DOMAIN}')"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫**

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebSocket
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –ø—Ä–∞–≤–∏–ª–∞
3. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Network ‚Üí WS –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### Avito –æ—Ç–∫–ª—é—á–∏–ª webhook

–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –¥–æ–ª—å—à–µ 2 —Å–µ–∫—É–Ω–¥
- Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ 4xx/5xx  
- –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ webhook:
```bash
python3 setup_avito_webhook.py unsubscribe
python3 setup_avito_webhook.py setup
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –°—Ç–∞—Ç—É—Å webhook endpoint
curl https://yourdomain.com/admin/avito/webhook/status

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
# –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –æ—Ç–≤–µ—Ç–µ –ø–æ–ª–µ "websocket_connections"
```

### –õ–æ–≥–∏

Webhook —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `app.admin.routers.avito` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook
- `app.services.avito_service` - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Avito API

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `https://yourdomain.com/admin/avito/`
2. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "üîó Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã"
3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∫–æ–≥–æ-—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–∞–º –≤ Avito
4. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

## üîÑ –û—Ç–∫–∞—Ç –∫ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ polling:

```bash
python3 setup_avito_webhook.py unsubscribe
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –æ–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

---

**üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ real-time –¥–∞–Ω–Ω—ã–µ.