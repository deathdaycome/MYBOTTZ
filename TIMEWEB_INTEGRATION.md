# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Timeweb Cloud

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Å–µ—Ä–≤–µ—Ä–∞—Ö –∏–∑ Timeweb Cloud API –≤ —Ä–∞–∑–¥–µ–ª "–•–æ—Å—Ç–∏–Ω–≥" CRM —Å–∏—Å—Ç–µ–º—ã.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤** –∏–∑ Timeweb Cloud
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, IP-–∞–¥—Ä–µ—Å–∞, —Å—Ç–∞—Ç—É—Å
- **–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞—Ä–∏—Ñ–æ–≤ Timeweb
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Ü–µ–Ω –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** —Ü–µ–Ω—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API —Ç–æ–∫–µ–Ω–∞ Timeweb Cloud

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Timeweb Cloud: https://timeweb.cloud/my
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **API –∏ Terraform**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π **JWT —Ç–æ–∫–µ–Ω** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ .env

–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
TIMEWEB_API_TOKEN=your_jwt_token_here
```

### 3. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
python migrations/add_timeweb_integration.py

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@147.45.215.199
cd /var/www/bot_business_card
docker exec -it bot-business-card python /app/migrations/add_timeweb_integration.py
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker-compose restart
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ CRM

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª **–•–æ—Å—Ç–∏–Ω–≥** –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. **–°–µ—Ä–≤–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. –í—Å–µ 23 —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ Timeweb Cloud —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
   - **–¶–µ–Ω—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞** (–≤–∞—à–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞)
   - –ü—Ä–∏–≤—è–∑–∫—É –∫ –ø—Ä–æ–µ–∫—Ç—É
   - –î–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

### –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- **–û–±–Ω–æ–≤–∏—Ç—å** - –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Timeweb** - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (–æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, IP, —Ü–µ–Ω—ã)
- **–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** - –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤—Ä—É—á–Ω—É—é

### API Endpoints

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```http
GET /admin/hosting/api/timeweb/status
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "configured": true,
  "message": "Timeweb API token configured"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–∑ Timeweb
```http
GET /admin/hosting/api/timeweb/servers
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "servers": [
    {
      "timeweb_id": 123456,
      "name": "my-server",
      "status": "on",
      "configuration": "2 CPU / 2GB RAM / 25GB SSD / Ubuntu 22.04",
      "ip_address": "1.2.3.4",
      "preset_id": 1,
      "is_imported": false
    }
  ],
  "total": 10,
  "imported_count": 5
}
```

#### –ò–º–ø–æ—Ä—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
```http
POST /admin/hosting/api/timeweb/import
Content-Type: application/json

{
  "server_ids": [123456, 789012]
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "imported": [
    {
      "server_id": 123456,
      "crm_id": 42,
      "name": "my-server"
    }
  ],
  "errors": [],
  "imported_count": 1,
  "error_count": 0
}
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
```http
POST /admin/hosting/api/server/{server_id}/sync
```

–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ Timeweb Cloud (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, IP, —Å—Ç–∞—Ç—É—Å, —Ü–µ–Ω—É).

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ HostingServer

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `timeweb_id` | BigInteger | ID —Å–µ—Ä–≤–µ—Ä–∞ –≤ Timeweb Cloud |
| `timeweb_status` | String(50) | –°—Ç–∞—Ç—É—Å –≤ Timeweb (on, off, etc.) |
| `timeweb_preset_id` | Integer | ID —Ç–∞—Ä–∏—Ñ–∞ –≤ Timeweb |
| `timeweb_data` | Text | –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API (JSON) |
| `auto_sync` | Boolean | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è |
| `last_sync_at` | DateTime | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–î–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å `auto_sync=True` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Celery:

```python
# app/tasks/sync_timeweb_servers.py
from celery import shared_task
from app.services.timeweb_service import timeweb_service
from app.database.models import HostingServer

@shared_task
def sync_timeweb_servers():
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã —Å auto_sync=True"""
    servers = HostingServer.query.filter_by(auto_sync=True).all()
    for server in servers:
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...
        pass
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Rate Limits**: Timeweb API –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç 20 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç
2. **–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ —Ç–∞—Ä–∏—Ñ–æ–≤ Timeweb
3. **–¶–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: API —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
5. **–ü—Ä–æ–µ–∫—Ç—ã**: –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
app/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ timeweb_service.py       # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å Timeweb API
‚îú‚îÄ‚îÄ admin/routers/
‚îÇ   ‚îî‚îÄ‚îÄ hosting.py                # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îî‚îÄ‚îÄ database/
    ‚îî‚îÄ‚îÄ models.py                 # –ú–æ–¥–µ–ª—å HostingServer

migrations/
‚îî‚îÄ‚îÄ add_timeweb_integration.py    # –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
```

### Timeweb API Documentation

- –ë–∞–∑–∞ URL: `https://api.timeweb.cloud/api/v1/`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://timeweb.cloud/api-docs
- OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: https://timeweb.cloud/api-docs-data/bundle.json

### –ú–µ—Ç–æ–¥—ã TimewebService

```python
from app.services.timeweb_service import timeweb_service

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
servers = await timeweb_service.get_servers()

# –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞
server = await timeweb_service.get_server_details(server_id)

# –ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å—ã –∞–∫–∫–∞—É–Ω—Ç–∞
finances = await timeweb_service.get_account_finances()

# –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã
presets = await timeweb_service.get_presets()

# –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = timeweb_service.parse_server_configuration(server)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ IP
ip = timeweb_service.get_primary_ip(server)
```

## üêõ Troubleshooting

### "Timeweb API token –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `TIMEWEB_API_TOKEN` –≤ .env
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

### "–°–µ—Ä–≤–µ—Ä —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω"
- –°–µ—Ä–≤–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ CRM —Å —ç—Ç–∏–º `timeweb_id`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –û—à–∏–±–∫–∏ HTTP 429
- –ü—Ä–µ–≤—ã—à–µ–Ω rate limit (20 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫)
- –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥

## üìù TODO

- [x] ~~–°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (–∫–Ω–æ–ø–∫–∞ + –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)~~ ‚Üí –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- [x] ~~–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é~~ ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [x] ~~–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ~~ ‚Üí Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ü–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Celery (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
