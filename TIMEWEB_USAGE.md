# Инструкция по использованию интеграции с Timeweb Cloud

## Результаты тестирования

### Успешно подключено
- ✅ API токен настроен и работает
- ✅ Получено серверов: **28 активных**
- ✅ Баланс аккаунта: **5 988.82 ₽**
- ✅ Доступно конфигураций: **66 вариантов**

## Как использовать интеграцию

### 1. Просмотр серверов в админке

В React-админке перейдите:
1. **Проекты** → Выберите проект → **Вкладка "Хостинг"**
2. Здесь вы можете:
   - Просматривать привязанные к проекту серверы
   - Привязывать существующие серверы к проекту
   - Видеть финансовую информацию (себестоимость, цена клиента, прибыль)

### 2. Автоматический импорт серверов из Timeweb

#### API endpoints доступны:

**Получить список серверов из Timeweb:**
```bash
GET /admin/hosting/api/timeweb/servers
```

**Автоматическая синхронизация всех серверов:**
```bash
POST /admin/hosting/api/timeweb/sync-all
```

Это создаст записи для новых серверов и обновит данные существующих:
- Конфигурация сервера
- IP-адрес
- Статус (on/off/blocked)
- Себестоимость (автоматически из тарифов Timeweb)

**Импорт конкретных серверов:**
```bash
POST /admin/hosting/api/timeweb/import
Content-Type: application/json

{
  "server_ids": [5348655, 5448569]
}
```

### 3. Список ваших серверов

На данный момент в Timeweb Cloud:

1. **CRM** (147.45.215.199) - 2 CPU / 4GB RAM - 1 500 ₽/мес
2. **Основной сайт** (85.198.83.116) - 1 CPU / 1GB RAM - 350 ₽/мес
3. **ВАШ ЧАРТЕР** (147.45.161.107) - 1 CPU / 1GB RAM - 350 ₽/мес
4. **VPN** (194.87.130.245) - 1 CPU / 1GB RAM - 510 ₽/мес
5. И еще 24 сервера...

**Общая стоимость всех серверов**: ~13 000 ₽/мес

### 4. Привязка серверов к проектам

После импорта серверов из Timeweb вам нужно:

1. Открыть проект в админке
2. Перейти на вкладку "Хостинг"
3. Нажать "Привязать сервер"
4. Выбрать сервер из списка
5. Указать:
   - Цену для клиента
   - Имя клиента
   - Даты оплаты

### 5. Автоматические обновления

Серверы с флагом `auto_sync=True` будут автоматически обновляться:
- Конфигурация
- IP-адреса
- Статусы
- Цены (если изменились тарифы)

### 6. Финансовый учет

Система автоматически рассчитывает:
- **Себестоимость**: цена Timeweb
- **Цена клиента**: ваша цена (настраивается вручную)
- **Прибыль**: разница между ценой клиента и себестоимостью
- **Процент прибыли**: (прибыль / цена клиента) × 100%

## API Reference

### Получить статус интеграции
```bash
GET /admin/hosting/api/timeweb/status

Response:
{
  "success": true,
  "configured": true,
  "message": "Timeweb API token configured"
}
```

### Получить серверы проекта
```bash
GET /admin/hosting/api/servers?project_id=1

Response:
{
  "success": true,
  "servers": [...],
  "total": 3
}
```

### Синхронизировать сервер с Timeweb
```bash
POST /admin/hosting/api/server/{server_id}/sync

Response:
{
  "success": true,
  "server": {...},
  "message": "Сервер успешно синхронизирован с Timeweb Cloud"
}
```

## Доступные тарифы Timeweb

### Популярные конфигурации:
1. **Базовый**: 1 CPU / 1GB RAM / 15GB SSD - **350 ₽/мес**
2. **Стандарт**: 1 CPU / 2GB RAM / 30GB SSD - **550 ₽/мес**
3. **Про**: 2 CPU / 4GB RAM / 50GB SSD - **1 000 ₽/мес**
4. **Бизнес**: 4 CPU / 8GB RAM / 80GB SSD - **1 800 ₽/мес**

## Troubleshooting

### Ошибка: "Timeweb API token не настроен"
**Решение**: Проверьте наличие `TIMEWEB_API_TOKEN` в файле `.env`

### Сервер не синхронизируется
**Решение**: Убедитесь что у сервера есть `timeweb_id` в базе данных

### Неверная цена сервера
**Решение**: Запустите синхронизацию сервера через API endpoint `/api/server/{id}/sync`

## Лицензия и ограничения

- **Rate Limit**: 20 запросов в секунду (Timeweb API)
- **Retry**: автоматические повторы при временных ошибках (3 попытки)
- **Timeout**: 30 секунд на запрос

---

**Документация Timeweb API**: https://timeweb.cloud/api-docs
