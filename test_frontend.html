<!DOCTYPE html>
<html>
<head>
    <title>Тест Avito Frontend</title>
    <script>
    // Тестируем загрузку чатов
    async function testLoadChats() {
        console.log('Тестируем загрузку чатов...');
        
        try {
            const response = await fetch('/admin/avito/chats', {
                headers: {
                    'Authorization': 'Basic ' + btoa('admin:qwerty123')
                }
            });
            
            console.log('Response status:', response.status);
            
            if (response.ok) {
                const data = await response.json();
                console.log('Данные получены:', data);
                console.log('Количество чатов:', data.chats?.length || 0);
                
                if (data.chats && data.chats.length > 0) {
                    console.log('Первый чат:', data.chats[0]);
                    console.log('Пользователи первого чата:', data.chats[0].users);
                }
                
                // Тестируем логику определения имени
                if (data.chats && data.chats.length > 0) {
                    const chat = data.chats[0];
                    const currentUserId = 216012096;
                    const userName = chat.users.find(u => u.id !== currentUserId)?.name || 'Неизвестный';
                    console.log('Имя собеседника:', userName);
                }
                
            } else {
                console.error('Ошибка:', response.status, await response.text());
            }
        } catch (error) {
            console.error('Ошибка запроса:', error);
        }
    }

    // Запускаем тест при загрузке
    window.onload = testLoadChats;
    </script>
</head>
<body>
    <h1>Тест Avito Frontend</h1>
    <p>Откройте Developer Tools (F12) и посмотрите в Console</p>
</body>
</html>