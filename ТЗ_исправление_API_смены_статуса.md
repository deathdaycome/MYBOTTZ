# ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Исправление API смены статуса проекта

## ПРОБЛЕМА
В веб-админке при попытке смены статуса проекта возникают ошибки 404/502. Необходимо исправить API эндпоинт для обновления статуса проекта по аналогии с исправлением API просмотра деталей проекта.

## АНАЛИЗ ТЕКУЩЕГО СОСТОЯНИЯ

### Найдено:
1. **API эндпоинт существует**: `PUT /api/projects/{project_id}/status` в `app/admin/routers/projects.py` (строка 225)
2. **Роутер подключен**: в `app/admin/app.py` (строка 43) роутер проектов подключен с префиксом `/api/projects`
3. **Фронтенд корректно обращается**: в `projects.html` (строка 517) используется правильный путь `/api/projects/${projectId}/status`
4. **Авторизация присутствует**: используется HTTP Basic Auth через `Depends(authenticate)`

### Проблемы (предположительные):
1. Возможные проблемы с импортом модулей в роутере
2. Возможные проблемы с аутентификацией
3. Возможные проблемы с сессией базы данных
4. Возможные проблемы с обработкой JSON-данных

## ТЕХНИЧЕСКОЕ ЗАДАНИЕ ПО ИСПРАВЛЕНИЮ

### Задача 1: Диагностика роутинга
**Файл**: `app/admin/routers/projects.py`
**Действия**:
- Добавить детальное логирование в начало функции `update_project_status`
- Проверить корректность импортов всех зависимостей
- Убедиться в отсутствии конфликтов имен

### Задача 2: Диагностика аутентификации
**Файл**: `app/admin/routers/projects.py`
**Действия**:
- Добавить логирование успешной аутентификации
- Проверить, что функция `authenticate` корректно импортирована и работает
- Убедиться в корректности передачи credentials с фронтенда

### Задача 3: Диагностика обработки данных
**Файл**: `app/admin/routers/projects.py`
**Действия**:
- Добавить логирование полученных JSON-данных
- Проверить корректность парсинга `await request.json()`
- Добавить валидацию входящих данных

### Задача 4: Диагностика базы данных
**Файл**: `app/admin/routers/projects.py`
**Действия**:
- Добавить логирование операций с БД
- Проверить корректность работы с сессией БД
- Убедиться в отсутствии блокировок транзакций

### Задача 5: Тестирование эндпоинта
**Действия**:
- Создать тестовый скрипт для прямого обращения к API
- Проверить ответы сервера в различных сценариях
- Убедиться в корректности HTTP-статусов

## ПЛАН РЕАЛИЗАЦИИ

### Этап 1: Добавление диагностики
1. Добавить подробное логирование в `update_project_status`
2. Проверить все импорты в роутере
3. Добавить логирование в точках входа/выхода функции

### Этап 2: Создание тестового скрипта
1. Создать скрипт `test_status_api.py` для тестирования API
2. Протестировать различные сценарии (валидные/невалидные данные)
3. Проанализировать логи и ответы сервера

### Этап 3: Исправление найденных проблем
1. Исправить проблемы, найденные на этапах 1-2
2. Убедиться в корректности работы уведомлений
3. Провести финальное тестирование

### Этап 4: Проверка интеграции
1. Протестировать работу через веб-интерфейс
2. Убедиться в корректности отображения изменений
3. Проверить работу уведомлений в Telegram

## ОЖИДАЕМЫЙ РЕЗУЛЬТАТ
- API `PUT /api/projects/{project_id}/status` работает без ошибок 404/502
- Смена статуса проекта в веб-админке происходит корректно
- Уведомления о смене статуса отправляются в Telegram
- Изменения отображаются в интерфейсе в реальном времени

## КРИТЕРИИ ПРИЕМКИ
1. ✅ API возвращает HTTP 200 при корректном запросе
2. ✅ Статус проекта сохраняется в базе данных
3. ✅ История изменений статусов ведется корректно
4. ✅ Уведомления отправляются клиентам в Telegram
5. ✅ Интерфейс админки обновляется без перезагрузки страницы
6. ✅ Обработка ошибочных запросов возвращает корректные HTTP-коды

## ФАЙЛЫ ДЛЯ ИЗМЕНЕНИЯ
- `app/admin/routers/projects.py` - основной файл с API
- `test_status_api.py` - новый тестовый скрипт
- Возможно: `app/admin/app.py` - если нужны изменения в роутинге

## ПРИОРИТЕТ
**Высокий** - критически важная функциональность для работы админки
