name: Test SSH Connection

on:
  workflow_dispatch:

jobs:
  test-ssh:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test SSH connection and secrets
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: ${{ secrets.SERVER_PORT }}
        script: |
          echo "üîç –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ò SECRETS"
          echo "============================="
          echo "‚úÖ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo "üåç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ:"
          echo "–•–æ—Å—Ç: $(hostname)"
          echo "IP: $(hostname -I | cut -d' ' -f1)"
          echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
          echo "–î–∞—Ç–∞/–≤—Ä–µ–º—è: $(date)"
          
          echo ""
          echo "üìç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:"
          if [ -d "/var/www/bot_business_card" ]; then
            echo "‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/www/bot_business_card –Ω–∞–π–¥–µ–Ω–∞"
            cd /var/www/bot_business_card
            echo "–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
            echo "üìã –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
            ls -la | head -5
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º git
            echo ""
            echo "üìù Git –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
            if [ -d ".git" ]; then
              echo "‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞–π–¥–µ–Ω"
              echo "–¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞: $(git branch --show-current)"
              echo "–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç: $(git log -1 --oneline)"
              echo "Remote URL: $(git remote -v | head -1)"
              
              # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–∂–µ–º –ª–∏ –º—ã –¥–µ–ª–∞—Ç—å git –æ–ø–µ—Ä–∞—Ü–∏–∏
              echo ""
              echo "üîß –¢–µ—Å—Ç–∏—Ä—É–µ–º git –æ–ø–µ—Ä–∞—Ü–∏–∏:"
              git status --porcelain | head -5
              
              # –ü—Ä–æ–±—É–µ–º fetch
              echo "–¢–µ—Å—Ç–∏—Ä—É–µ–º git fetch..."
              if git fetch origin main 2>/dev/null; then
                echo "‚úÖ git fetch —Ä–∞–±–æ—Ç–∞–µ—Ç"
              else
                echo "‚ùå git fetch –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
                echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º SSH –∫–ª—é—á–∏ –∏ –¥–æ—Å—Ç—É–ø –∫ GitHub..."
                ssh -T git@github.com 2>&1 | head -3 || echo "SSH —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω"
              fi
            else
              echo "‚ùå Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ù–ï –Ω–∞–π–¥–µ–Ω"
            fi
          else
            echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/www/bot_business_card –ù–ï –Ω–∞–π–¥–µ–Ω–∞!"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /var/www/:"
            ls -la /var/www/ || echo "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/www –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          fi
          
          echo ""
          echo "‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω"