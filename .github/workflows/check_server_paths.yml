name: Check Server Paths

on:
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  check-paths:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check server file paths and content
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: ${{ secrets.SERVER_PORT }}
        script: |
          echo "üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–£–¢–ï–ô –ù–ê –°–ï–†–í–ï–†–ï"
          echo "================================="
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
          echo "üìç –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:"
          pwd
          
          # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
          cd /var/www/bot_business_card
          
          echo "üìç –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞:"
          pwd
          ls -la
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ admin
          echo ""
          echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ app/admin:"
          find app/admin -type f -name "*.html" -o -name "*.py" | head -20
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∞–±–ª–æ–Ω—ã
          echo ""
          echo "üìÑ –®–∞–±–ª–æ–Ω—ã –≤ app/admin/templates:"
          ls -la app/admin/templates/ || echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è templates –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª avito_messenger.html
          echo ""
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º avito_messenger.html:"
          if [ -f "app/admin/templates/avito_messenger.html" ]; then
            echo "‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω"
            echo "üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(wc -c < app/admin/templates/avito_messenger.html) bytes"
            echo "üìÖ –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: $(stat -c %y app/admin/templates/avito_messenger.html)"
            
            # –ò—â–µ–º –Ω–∞—à debug –±–ª–æ–∫
            echo ""
            echo "üîç –ò—â–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –±–ª–æ–∫:"
            if grep -q "üö® –û–¢–õ–ê–î–ö–ê" app/admin/templates/avito_messenger.html; then
              echo "‚úÖ Debug –±–ª–æ–∫ –Ω–∞–π–¥–µ–Ω!"
              grep -n "üö® –û–¢–õ–ê–î–ö–ê" app/admin/templates/avito_messenger.html | head -3
            else
              echo "‚ùå Debug –±–ª–æ–∫ –ù–ï –Ω–∞–π–¥–µ–Ω!"
            fi
            
            # –ò—â–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏
            echo ""
            echo "üîç –ò—â–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ AI:"
            if grep -q "autoResponseMode" app/admin/templates/avito_messenger.html; then
              echo "‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –Ω–∞–π–¥–µ–Ω—ã!"
              grep -c "autoResponseMode" app/admin/templates/avito_messenger.html
              echo "–°—Ç—Ä–æ–∫–∏ —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è–º–∏:"
              grep -n "autoResponseMode" app/admin/templates/avito_messenger.html | head -5
            else
              echo "‚ùå –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω—ã!"
            fi
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ñ–∞–π–ª–∞
            echo ""
            echo "üìù –ü–µ—Ä–≤—ã–µ 50 —Å—Ç—Ä–æ–∫ —Ñ–∞–π–ª–∞:"
            head -50 app/admin/templates/avito_messenger.html
            
          else
            echo "‚ùå –§–∞–π–ª avito_messenger.html –ù–ï –Ω–∞–π–¥–µ–Ω!"
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
          echo ""
          echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ:"
          git log -1 --oneline --no-merges
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
          echo ""
          echo "üìã Git —Å—Ç–∞—Ç—É—Å:"
          git status --porcelain
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å PM2
          echo ""
          echo "üöÄ PM2 —Å—Ç–∞—Ç—É—Å:"
          pm2 status
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ PM2
          echo ""
          echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ PM2:"
          pm2 logs bot-business-card --lines 10 --nostream
          
          echo ""
          echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"