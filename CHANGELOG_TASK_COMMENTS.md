# Changelog: –£–ª—É—á—à–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º

## –î–∞—Ç–∞: 22.10.2025

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### 1. –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –∑–∞–¥–∞—á
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/uploads/task_comments/`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–¥–æ–∫—É–º–µ–Ω—Ç)

#### 2. –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **–°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí –ê–¥–º–∏–Ω**: –ö–æ–≥–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- ‚úÖ **–ê–¥–º–∏–Ω ‚Üí –°–æ—Ç—Ä—É–¥–Ω–∏–∫**: –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–¥–∞—á–∏ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- ‚úÖ –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

#### 3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_read` –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `read_by` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- ‚úÖ API –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- ‚úÖ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

#### –ú–æ–¥–µ–ª—å TaskComment
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è:
```python
is_read = Column(Boolean, default=False)  # –ü—Ä–æ—á–∏—Ç–∞–Ω –ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
read_by = Column(JSON, default=lambda: [])  # –°–ø–∏—Å–æ–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
```

### üì° –ù–æ–≤—ã–µ API endpoints

#### 1. POST `/admin/api/tasks/{task_id}/comments`
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å —Ñ–∞–π–ª–∞–º–∏:
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  - `comment` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - `is_internal` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `files` (List[UploadFile], –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - **–ù–û–í–û–ï!**
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

#### 2. POST `/admin/tasks/{task_id}/comments/{comment_id}/mark_read`
–û—Ç–º–µ—Ç–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π:
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `{"success": true, "message": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π"}`

#### 3. GET `/admin/api/tasks/{task_id}/unread_comments_count`
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `{"success": true, "task_id": 123, "unread_count": 5}`

#### 4. GET `/admin/api/tasks/{task_id}/comments`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∑–∞–¥–∞—á–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏:
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –ø–æ–ª–µ–º `is_read_by_me` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ

### üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **app/database/models.py**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `is_read` –∏ `read_by` –≤ –º–æ–¥–µ–ª—å `TaskComment`
   - –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `to_dict()` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

2. **app/database/migrations/migration_010_add_comment_read_status.py**
   - –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π –≤ –ë–î

3. **app/admin/routers/tasks.py**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `add_task_comment()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

4. **app/services/task_notification_service.py**
   - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∞–¥–º–∏–Ω ‚Üî —Å–æ—Ç—Ä—É–¥–Ω–∏–∫)
   - –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

### üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

#### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
```bash
cd /var/www/bot_business_card
python3 app/database/migrations/migration_010_add_comment_read_status.py
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
```bash
mkdir -p uploads/task_comments
chmod 755 uploads/task_comments
```

#### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
docker-compose restart
# –∏–ª–∏
systemctl restart bot-business-card
```

### üìù TODO (–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏)

1. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (tasks.html)**:
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ —Ñ–æ—Ä–º—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞–¥ –∏–∫–æ–Ω–∫–æ–π —Ç–∞–π–º–µ—Ä–∞
   - –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–º–µ—Ç–∫—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∑–∞–¥–∞—á–∏

2. **Live-—Ç–∞–π–º–µ—Ä**:
   - –û–±–Ω–æ–≤–∏—Ç—å JavaScript –∫–æ–¥ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–µ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
   - –î–æ–±–∞–≤–∏—Ç—å WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞

### üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ FastAPI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ UI —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- Live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å —Ñ–∞–π–ª–æ–º (cURL)
```bash
curl -X POST "http://localhost:8001/admin/api/tasks/1/comments" \
  -H "Authorization: Basic ..." \
  -F "comment=–í–æ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–æ–±–ª–µ–º—ã" \
  -F "is_internal=false" \
  -F "files=@screenshot.png"
```

#### –û—Ç–º–µ—Ç–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
```bash
curl -X POST "http://localhost:8001/admin/tasks/1/comments/5/mark_read" \
  -H "Authorization: Basic ..."
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
```bash
curl "http://localhost:8001/admin/api/tasks/1/unread_comments_count" \
  -H "Authorization: Basic ..."
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**: 4
- **–î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~250
- **–ù–æ–≤—ã—Ö API endpoints**: 4
- **–ù–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ë–î**: 2
- **–ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: 1

---

**–ê–≤—Ç–æ—Ä**: Claude AI
**–î–∞—Ç–∞**: 22 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0.0
