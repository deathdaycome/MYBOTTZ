<!DOCTYPE html>
<html>
<head>
    <title>Debug Avito Frontend</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-left: 3px solid #007bff; }
        .error { border-left-color: #dc3545; background: #fff5f5; }
        .success { border-left-color: #28a745; background: #f5fff5; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Debug Avito Frontend</h1>
    
    <button onclick="testChats()">–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤</button>
    <button onclick="testMessages()">–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</button>
    <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    
    <div id="logs"></div>

    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }
        
        function clearLogs() {
            logs.innerHTML = '';
        }
        
        // –°–æ–∑–¥–∞–µ–º Basic Auth –∑–∞–≥–æ–ª–æ–≤–æ–∫
        const auth = btoa('admin:qwerty123');
        const headers = {
            'Authorization': `Basic ${auth}`,
            'Content-Type': 'application/json'
        };
        
        async function testChats() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —á–∞—Ç–æ–≤...');
            
            try {
                const response = await fetch('/admin/avito/chats', { headers });
                
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                log(`üìä –ó–∞–≥–æ–ª–æ–≤–∫–∏: ${JSON.stringify(Object.fromEntries(response.headers))}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`, 'success');
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–π —á–∞—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
                    if (data.chats && data.chats.length > 0) {
                        window.testChatId = data.chats[0].id;
                        log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω ID —á–∞—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞: ${window.testChatId}`, 'success');
                    }
                    
                } else {
                    const errorText = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ ${response.status}: ${errorText}`, 'error');
                    
                    try {
                        const errorData = JSON.parse(errorText);
                        log(`üîç –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    } catch (e) {
                        log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—à–∏–±–∫—É –∫–∞–∫ JSON`, 'error');
                    }
                }
                
            } catch (error) {
                log(`üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
                log(`üìç Stack trace: ${error.stack}`, 'error');
            }
        }
        
        async function testMessages() {
            const chatId = window.testChatId || 'u2i-tIiKX21UKaBNFasNXH5v3A';
            
            log(`üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —á–∞—Ç–∞: ${chatId}`);
            
            try {
                const url = `/admin/avito/chats/${chatId}/messages`;
                log(`üåê URL –∑–∞–ø—Ä–æ—Å–∞: ${url}`);
                
                const response = await fetch(url, { headers });
                
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                log(`üìä –ó–∞–≥–æ–ª–æ–≤–∫–∏: ${JSON.stringify(Object.fromEntries(response.headers))}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è: ${JSON.stringify(data, null, 2)}`, 'success');
                    
                } else {
                    const errorText = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ ${response.status}: ${errorText}`, 'error');
                    
                    try {
                        const errorData = JSON.parse(errorText);
                        log(`üîç –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    } catch (e) {
                        log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—à–∏–±–∫—É –∫–∞–∫ JSON`, 'error');
                    }
                }
                
            } catch (error) {
                log(`üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
                log(`üìç Stack trace: ${error.stack}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —á–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ—Ç–µ—Å—Ç');
            setTimeout(testChats, 1000);
        };
    </script>
</body>
</html>