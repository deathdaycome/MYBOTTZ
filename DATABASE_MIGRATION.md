# Миграция базы данных

## Описание

Скрипты для безопасной миграции и синхронизации данных между локальной и серверной базой данных.

## Файлы

- `analyze_db_differences.py` - анализ различий между базами
- `migrate_database.py` - основной скрипт миграции
- `database_dump.sql` - полный дамп локальной базы данных

## Использование

### 1. Анализ различий

```bash
python3 analyze_db_differences.py
```

### 2. Миграция на сервере

```bash
# Остановить приложение
pm2 stop bot-business-card

# Выполнить миграцию
python3 migrate_database.py data/bot.db

# Запустить приложение
pm2 start bot-business-card
```

## Что делает миграция

1. **Создает резервную копию** серверной БД
2. **Обновляет схему таблицы users** - добавляет недостающие колонки:
   - bot_token (VARCHAR(500))
   - timeweb_login (VARCHAR(255))
   - timeweb_password (VARCHAR(255))
   - user_telegram_id (VARCHAR(50))
   - chat_id (VARCHAR(50))
   - bot_configured (BOOLEAN DEFAULT FALSE)

3. **Синхронизирует данные** из локальной БД в серверную:
   - 25 пользователей
   - 4 проекта портфолио
   - 9 финансовых транзакций
   - 18 задач
   - 21 категория денег
   - И другие данные

4. **Избегает дубликатов** - использует INSERT OR IGNORE
5. **Создает подробный лог** миграции

## Безопасность

- Автоматическое создание резервной копии перед миграцией
- Подробное логирование всех операций
- Обработка ошибок и откат при проблемах
- Проверка целостности данных

## Результат

После миграции серверная БД будет содержать:
- Обновленную схему таблиц
- Все данные из локальной БД
- Сохраненные существующие данные сервера
- Полную совместимость с приложением