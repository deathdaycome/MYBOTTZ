{% extends "base.html" %}

{% block title %}–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block page_title %}üé® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ{% endblock %}

{% block extra_css %}
<style>
:root {
    --portfolio-primary: #6f42c1;
    --portfolio-secondary: #e83e8c;
    --portfolio-success: #28a745;
    --portfolio-info: #17a2b8;
    --portfolio-warning: #ffc107;
    --portfolio-danger: #dc3545;
    --portfolio-light: #f8f9fa;
    --portfolio-dark: #343a40;
    --shadow-light: 0 2px 4px rgba(0,0,0,0.1);
    --shadow-medium: 0 4px 8px rgba(0,0,0,0.15);
    --shadow-heavy: 0 8px 16px rgba(0,0,0,0.2);
    --border-radius: 12px;
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.portfolio-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 15px;
}

/* Header Actions - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã */
.header-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    min-height: 45px;
}

.btn-portfolio {
    min-width: 120px;
    height: 38px;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 500;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: var(--transition-smooth);
    text-decoration: none;
    white-space: nowrap;
    position: relative;
    overflow: hidden;
}

.btn-portfolio:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn-portfolio:hover:before {
    left: 100%;
}

.btn-portfolio-success {
    background: linear-gradient(135deg, var(--portfolio-success), #20c997);
    color: white;
    box-shadow: var(--shadow-light);
}

.btn-portfolio-primary {
    background: linear-gradient(135deg, var(--portfolio-primary), #7952b3);
    color: white;
    box-shadow: var(--shadow-light);
}

.btn-portfolio-info {
    background: linear-gradient(135deg, var(--portfolio-info), #138496);
    color: white;
    box-shadow: var(--shadow-light);
}

.btn-portfolio-secondary {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    color: white;
    box-shadow: var(--shadow-light);
}

/* Filters Card - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
.filters-card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-light);
    margin-bottom: 24px;
    border: 1px solid #e9ecef;
    min-height: 80px;
}

.filters-content {
    padding: 20px;
}

.filters-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 120px;
    gap: 16px;
    align-items: center;
}

.filter-group {
    position: relative;
}

.filter-input, .filter-select {
    width: 100%;
    height: 40px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 14px;
    transition: var(--transition-smooth);
    background: white;
}

.filter-input:focus, .filter-select:focus {
    border-color: var(--portfolio-primary);
    box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.1);
    outline: none;
}

.search-wrapper {
    position: relative;
}

.search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    z-index: 2;
}

.search-input {
    padding-left: 40px !important;
}

.view-toggle {
    display: flex;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    overflow: hidden;
    height: 40px;
}

.view-btn {
    flex: 1;
    border: none;
    background: white;
    color: #6c757d;
    transition: var(--transition-smooth);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.view-btn.active {
    background: var(--portfolio-primary);
    color: white;
}

/* Stats Cards - –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 24px;
    box-shadow: var(--shadow-light);
    border: 1px solid #e9ecef;
    position: relative;
    overflow: hidden;
    min-height: 120px;
    display: flex;
    align-items: center;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--stat-color, var(--portfolio-primary));
}

.stat-content {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 16px;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
    background: var(--stat-color, var(--portfolio-primary));
    flex-shrink: 0;
}

.stat-details h3 {
    font-size: 28px;
    font-weight: 700;
    margin: 0 0 4px 0;
    color: var(--portfolio-dark);
}

.stat-details p {
    margin: 0;
    color: #6c757d;
    font-size: 14px;
    font-weight: 500;
}

.stat-card-primary { --stat-color: var(--portfolio-primary); }
.stat-card-success { --stat-color: var(--portfolio-success); }
.stat-card-info { --stat-color: var(--portfolio-info); }
.stat-card-warning { --stat-color: var(--portfolio-warning); }

/* Portfolio Grid - –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ */
.portfolio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 24px;
    margin-bottom: 30px;
}

.portfolio-card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-light);
    border: 1px solid #e9ecef;
    overflow: hidden;
    transition: var(--transition-smooth);
    position: relative;
    min-height: 400px;
    display: flex;
    flex-direction: column;
}

.portfolio-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-heavy);
}

.card-image-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition-smooth);
}

.portfolio-card:hover .card-image {
    transform: scale(1.05);
}

.image-placeholder {
    color: #6c757d;
    font-size: 48px;
    font-weight: 300;
}

.card-badges {
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.status-badge, .category-badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.status-featured {
    background: rgba(255, 193, 7, 0.9);
    color: #856404;
}

.status-active {
    background: rgba(40, 167, 69, 0.9);
    color: white;
}

.category-badge {
    background: rgba(111, 66, 193, 0.9);
    color: white;
}

.card-content {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.card-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: var(--portfolio-dark);
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-subtitle {
    font-size: 14px;
    color: #6c757d;
    margin: 0 0 12px 0;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-description {
    font-size: 14px;
    color: #6c757d;
    line-height: 1.5;
    margin: 0 0 16px 0;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-technologies {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 16px;
}

.tech-tag {
    padding: 2px 8px;
    background: #e9ecef;
    color: #495057;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
}

.card-meta {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
}

.meta-item {
    text-align: center;
}

.meta-value {
    font-size: 16px;
    font-weight: 600;
    color: var(--portfolio-dark);
    margin: 0;
}

.meta-label {
    font-size: 11px;
    color: #6c757d;
    text-transform: uppercase;
    font-weight: 500;
    margin: 2px 0 0 0;
}

.card-actions {
    display: flex;
    gap: 8px;
    margin-top: auto;
}

.card-btn {
    flex: 1;
    height: 36px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    text-decoration: none;
}

.card-btn-primary {
    background: var(--portfolio-primary);
    color: white;
}

.card-btn-outline {
    background: transparent;
    color: var(--portfolio-primary);
    border: 1px solid var(--portfolio-primary);
}

.card-btn:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-light);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 8px 0;
}

.empty-description {
    font-size: 14px;
    margin: 0 0 20px 0;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .filters-row {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .portfolio-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
}

@media (max-width: 768px) {
    .header-actions {
        justify-content: center;
    }
    
    .btn-portfolio {
        min-width: 100px;
        font-size: 12px;
    }
    
    .portfolio-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
}

/* Loading Animation */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(5px);
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #e9ecef;
    border-top: 3px solid var(--portfolio-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Animation Classes */
.fade-in {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}

{% block header_actions %}
<div class="header-actions">
    <button class="btn-portfolio btn-portfolio-success" onclick="openPortfolioModal()">
        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
    </button>
    <button class="btn-portfolio btn-portfolio-primary" onclick="reorderPortfolio()">
        <i class="fas fa-sort"></i> –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
    </button>
    <button class="btn-portfolio btn-portfolio-info" onclick="importPortfolio()">
        <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç
    </button>
    <button class="btn-portfolio btn-portfolio-secondary" onclick="exportPortfolio()">
        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
    </button>
</div>
{% endblock %}

{% block content %}
<div class="portfolio-container">
    <!-- Filters and Search -->
    <div class="filters-card">
        <div class="filters-content">
            <div class="filters-row">
                <div class="filter-group">
                    <div class="search-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="filter-input search-input" id="searchPortfolio" 
                               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º...">
                    </div>
                </div>
                <div class="filter-group">
                    <select class="filter-select" id="categoryFilter">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="telegram_bots">ü§ñ Telegram –±–æ—Ç—ã</option>
                        <option value="web_development">üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</option>
                        <option value="mobile_apps">üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</option>
                        <option value="ai_integration">üß† AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</option>
                        <option value="automation">‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</option>
                        <option value="ecommerce">üõí E-commerce</option>
                        <option value="other">üîß –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select class="filter-select" id="statusFilter">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="featured">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</option>
                        <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</option>
                        <option value="archived">–ê—Ä—Ö–∏–≤–Ω—ã–µ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select class="filter-select" id="sortBy">
                        <option value="created_desc">–ù–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                        <option value="created_asc">–°—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                        <option value="title_asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ê-–Ø</option>
                        <option value="title_desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ø-–ê</option>
                        <option value="order_asc">–ü–æ –ø–æ—Ä—è–¥–∫—É</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="view-toggle">
                        <button class="view-btn active" id="gridView" onclick="setViewMode('grid')">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="view-btn" id="listView" onclick="setViewMode('list')">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Stats -->
    <div class="stats-grid">
        <div class="stat-card stat-card-primary">
            <div class="stat-content">
                <div class="stat-icon">
                    <i class="fas fa-folder"></i>
                </div>
                <div class="stat-details">
                    <h3 id="totalProjects">{{ portfolio_stats.total or 0 }}</h3>
                    <p>–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="stat-card stat-card-success">
            <div class="stat-content">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-details">
                    <h3 id="featuredProjects">{{ portfolio_stats.featured or 0 }}</h3>
                    <p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</p>
                </div>
            </div>
        </div>
        <div class="stat-card stat-card-info">
            <div class="stat-content">
                <div class="stat-icon">
                    <i class="fas fa-eye"></i>
                </div>
                <div class="stat-details">
                    <h3 id="totalViews">{{ portfolio_stats.total_views or 0 }}</h3>
                    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="stat-card stat-card-warning">
            <div class="stat-content">
                <div class="stat-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="stat-details">
                    <h3 id="totalLikes">{{ portfolio_stats.total_likes or 0 }}</h3>
                    <p>–õ–∞–π–∫–æ–≤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Grid -->
    <div class="portfolio-grid" id="portfolioGrid">
        {% if portfolio_items %}
            {% for item in portfolio_items %}
            <div class="portfolio-card fade-in" data-category="{{ item.category or 'other' }}" 
                 data-status="{% if item.is_featured %}featured{% elif item.is_visible %}active{% else %}draft{% endif %}">
                <div class="card-image-container">
                    {% if item.main_image %}
                        <img src="{{ item.main_image }}" alt="{{ item.title }}" class="card-image">
                    {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                    {% endif %}
                    <div class="card-badges">
                        <div>
                            {% if item.is_featured %}
                                <span class="status-badge status-featured">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ</span>
                            {% elif item.is_visible %}
                                <span class="status-badge status-active">–ê–∫—Ç–∏–≤–Ω—ã–π</span>
                            {% endif %}
                        </div>
                        <div>
                            <span class="category-badge">
                                {% if item.category == 'telegram_bots' %}ü§ñ –ë–æ—Ç—ã
                                {% elif item.category == 'web_development' %}üåê –í–µ–±
                                {% elif item.category == 'mobile_apps' %}üì± –ú–æ–±–∏–ª—å–Ω—ã–µ
                                {% elif item.category == 'ai_integration' %}üß† AI
                                {% elif item.category == 'automation' %}‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
                                {% elif item.category == 'ecommerce' %}üõí E-commerce
                                {% else %}üîß –î—Ä—É–≥–æ–µ
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <h3 class="card-title">{{ item.title }}</h3>
                    {% if item.subtitle %}
                        <p class="card-subtitle">{{ item.subtitle }}</p>
                    {% endif %}
                    <p class="card-description">{{ item.description }}</p>
                    
                    {% if item.technologies %}
                        <div class="card-technologies">
                            {% for tech in item.technologies.split(',') %}
                                <span class="tech-tag">{{ tech.strip() }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <div class="card-meta">
                        <div class="meta-item">
                            <p class="meta-value">{{ item.development_time or 'N/A' }}</p>
                            <p class="meta-label">–î–Ω–∏</p>
                        </div>
                        <div class="meta-item">
                            <p class="meta-value">
                                {% if item.show_cost and item.cost %}
                                    {{ "{:,.0f}".format(item.cost) }}‚ÇΩ
                                {% else %}
                                    –ü–æ –∑–∞–ø—Ä–æ—Å—É
                                {% endif %}
                            </p>
                            <p class="meta-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</p>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="card-btn card-btn-primary" onclick="editPortfolioItem({{ item.id }})">
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="card-btn card-btn-outline" onclick="previewPortfolioItem({{ item.id }})">
                            <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-folder-open"></i>
                </div>
                <h3 class="empty-title">–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø—É—Å—Ç–æ</h3>
                <p class="empty-description">
                    –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
                </p>
                <button class="btn-portfolio btn-portfolio-success" onclick="openPortfolioModal()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç
                </button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –í–ê–ñ–ù–û: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É
console.log('Portfolio script loading...');

// Portfolio Management System
class PortfolioManager {
    constructor() {
        this.currentView = 'grid';
        this.currentFilters = {
            search: '',
            category: '',
            status: '',
            sort: 'created_desc'
        };
        this.init();
    }

    init() {
        this.bindEvents();
        this.loadPortfolio();
    }

    bindEvents() {
        // Search
        const searchInput = document.getElementById('searchPortfolio');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.currentFilters.search = e.target.value;
                this.debounce(() => this.filterPortfolio(), 300)();
            });
        }

        // Filters
        ['categoryFilter', 'statusFilter', 'sortBy'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', (e) => {
                    const filterType = id.replace('Filter', '').replace('sortBy', 'sort');
                    this.currentFilters[filterType] = e.target.value;
                    this.filterPortfolio();
                });
            }
        });
    }

    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    showLoading() {
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
        }
    }

    hideLoading() {
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
        }
    }

    async loadPortfolio() {
        try {
            this.showLoading();
            const response = await fetch('/admin/api/portfolio');
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    this.renderPortfolio(data.items);
                    this.updateStats(data.stats);
                }
            }
        } catch (error) {
            console.error('Error loading portfolio:', error);
            this.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ');
        } finally {
            this.hideLoading();
        }
    }

    filterPortfolio() {
        const cards = document.querySelectorAll('.portfolio-card');
        cards.forEach(card => {
            const title = card.querySelector('.card-title').textContent.toLowerCase();
            const description = card.querySelector('.card-description').textContent.toLowerCase();
            const category = card.dataset.category;
            const status = card.dataset.status;

            const matchesSearch = !this.currentFilters.search || 
                title.includes(this.currentFilters.search.toLowerCase()) ||
                description.includes(this.currentFilters.search.toLowerCase());
                
            const matchesCategory = !this.currentFilters.category || 
                category === this.currentFilters.category;
                
            const matchesStatus = !this.currentFilters.status || 
                status === this.currentFilters.status;

            if (matchesSearch && matchesCategory && matchesStatus) {
                card.style.display = 'flex';
                card.classList.add('fade-in');
            } else {
                card.style.display = 'none';
                card.classList.remove('fade-in');
            }
        });
    }

    renderPortfolio(items) {
        // Implementation for rendering portfolio items
        // This would be called when loading portfolio via API
    }

    updateStats(stats) {
        if (stats) {
            const totalProjects = document.getElementById('totalProjects');
            const featuredProjects = document.getElementById('featuredProjects');
            const totalViews = document.getElementById('totalViews');
            const totalLikes = document.getElementById('totalLikes');
            
            if (totalProjects) totalProjects.textContent = stats.total || 0;
            if (featuredProjects) featuredProjects.textContent = stats.featured || 0;
            if (totalViews) totalViews.textContent = stats.total_views || 0;
            if (totalLikes) totalLikes.textContent = stats.total_likes || 0;
        }
    }

    showError(message) {
        // Simple error notification
        console.error(message);
        if (typeof showNotification === 'function') {
            showNotification(message, 'danger');
        } else {
            alert(message);
        }
    }
}

// –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

// View Mode Functions
function setViewMode(mode) {
    console.log('setViewMode called with:', mode);
    try {
        const gridBtn = document.getElementById('gridView');
        const listBtn = document.getElementById('listView');
        const portfolioGrid = document.getElementById('portfolioGrid');

        if (!gridBtn || !listBtn || !portfolioGrid) {
            console.error('Required elements not found for setViewMode');
            return;
        }

        if (mode === 'grid') {
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
            portfolioGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(350px, 1fr))';
        } else {
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
            portfolioGrid.style.gridTemplateColumns = '1fr';
        }
    } catch (error) {
        console.error('Error in setViewMode:', error);
    }
}

// Modal Functions
function openPortfolioModal() {
    console.log('openPortfolioModal called');
    // Implementation for opening portfolio modal
    if (typeof showNotification === 'function') {
        showNotification('–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    } else {
        alert('–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function editPortfolioItem(id) {
    console.log('editPortfolioItem called with id:', id);
    try {
        if (!id) {
            console.error('No ID provided to editPortfolioItem');
            return;
        }
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        openEditModal(id);
    } catch (error) {
        console.error('Error in editPortfolioItem:', error);
        if (typeof showNotification === 'function') {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'danger');
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message);
        }
    }
}

function previewPortfolioItem(id) {
    console.log('previewPortfolioItem called with id:', id);
    try {
        if (!id) {
            console.error('No ID provided to previewPortfolioItem');
            return;
        }
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
        const previewUrl = `/admin/portfolio/preview/${id}`;
        console.log('Opening preview URL:', previewUrl);
        window.open(previewUrl, '_blank');
    } catch (error) {
        console.error('Error in previewPortfolioItem:', error);
        if (typeof showNotification === 'function') {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: ' + error.message, 'danger');
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: ' + error.message);
        }
    }
}

async function openEditModal(id) {
    try {
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
        const response = await fetch(`/admin/api/portfolio/${id}`);
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞');
        }
        
        const data = await response.json();
        console.log('API response data:', data); // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É
        
        if (!data.success) {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API
        const project = data.project || data.data;
        if (!project) {
            console.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API:', data);
            throw new Error('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ API');
        }
        
        console.log('Project data:', project); // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É
        
        // –°–æ–∑–¥–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const safeProject = {
            title: project.title || '',
            category: project.category || 'other',
            subtitle: project.subtitle || '',
            description: project.description || '',
            technologies: project.technologies || '',
            complexity: project.complexity || 'simple',
            development_time: project.development_time || '',
            cost: project.cost || '',
            sort_order: project.sort_order || 0,
            demo_link: project.demo_link || '',
            repository_link: project.repository_link || '',
            main_image: project.main_image || '',
            is_featured: project.is_featured || false,
            is_visible: project.is_visible || false,
            show_cost: project.show_cost || false
        };
        
        console.log('Safe project data:', safeProject); // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modalHtml = `
            <div class="modal fade" id="editPortfolioModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="editPortfolioForm" enctype="multipart/form-data">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *</label>
                                            <input type="text" class="form-control" name="title" value="${safeProject.title}" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                                            <select class="form-select" name="category" required>
                                                <option value="telegram_bots" ${safeProject.category === 'telegram_bots' ? 'selected' : ''}>ü§ñ Telegram –±–æ—Ç—ã</option>
                                                <option value="web_development" ${safeProject.category === 'web_development' ? 'selected' : ''}>üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</option>
                                                <option value="mobile_apps" ${safeProject.category === 'mobile_apps' ? 'selected' : ''}>üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</option>
                                                <option value="ai_integration" ${safeProject.category === 'ai_integration' ? 'selected' : ''}>üß† AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</option>
                                                <option value="automation" ${safeProject.category === 'automation' ? 'selected' : ''}>‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</option>
                                                <option value="ecommerce" ${safeProject.category === 'ecommerce' ? 'selected' : ''}>üõí E-commerce</option>
                                                <option value="other" ${safeProject.category === 'other' ? 'selected' : ''}>üîß –î—Ä—É–≥–æ–µ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                                    <input type="text" class="form-control" name="subtitle" value="${safeProject.subtitle}" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞...">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *</label>
                                    <textarea class="form-control" name="description" rows="4" required>${safeProject.description}</textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</label>
                                            <input type="text" class="form-control" name="technologies" value="${safeProject.technologies}" placeholder="Python, FastAPI, PostgreSQL...">
                                            <small class="text-muted">–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                                            <select class="form-select" name="complexity">
                                                <option value="simple" ${safeProject.complexity === 'simple' ? 'selected' : ''}>üü¢ –ü—Ä–æ—Å—Ç–∞—è</option>
                                                <option value="medium" ${safeProject.complexity === 'medium' ? 'selected' : ''}>üü° –°—Ä–µ–¥–Ω—è—è</option>
                                                <option value="complex" ${safeProject.complexity === 'complex' ? 'selected' : ''}>üî¥ –°–ª–æ–∂–Ω–∞—è</option>
                                                <option value="premium" ${safeProject.complexity === 'premium' ? 'selected' : ''}>üü£ –ü—Ä–µ–º–∏—É–º</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–¥–Ω–∏)</label>
                                            <input type="number" class="form-control" name="development_time" value="${safeProject.development_time}" min="1">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                                            <input type="number" class="form-control" name="cost" value="${safeProject.cost}" min="0">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                                            <input type="number" class="form-control" name="sort_order" value="${safeProject.sort_order}" min="0">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ–º–æ</label>
                                            <input type="url" class="form-control" name="demo_link" value="${safeProject.demo_link}" placeholder="https://...">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</label>
                                            <input type="url" class="form-control" name="repository_link" value="${safeProject.repository_link}" placeholder="https://github.com/...">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">–ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                                    <input type="file" class="form-control" name="main_image" accept="image/*">
                                    ${safeProject.main_image ? `<small class="text-muted">–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${safeProject.main_image}</small>` : ''}
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" name="is_featured" ${safeProject.is_featured ? 'checked' : ''}>
                                            <label class="form-check-label">‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—Ä–æ–µ–∫—Ç</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" name="is_visible" ${safeProject.is_visible ? 'checked' : ''}>
                                            <label class="form-check-label">üëÅ –í–∏–¥–∏–º—ã–π –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" name="show_cost" ${safeProject.show_cost ? 'checked' : ''}>
                                            <label class="form-check-label">üí∞ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∏—Ç—å
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        `;
        
        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
        const existingModal = document.getElementById('editPortfolioModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª –≤ DOM
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
        const modal = new bootstrap.Modal(document.getElementById('editPortfolioModal'));
        modal.show();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('editPortfolioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await savePortfolioChanges(id, e.target, modal);
        });
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∞:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message);
    }
}

async function savePortfolioChanges(id, form, modal) {
    try {
        const formData = new FormData(form);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        submitBtn.disabled = true;
        
        const response = await fetch(`/admin/api/portfolio/${id}`, {
            method: 'PUT',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª
            modal.hide();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showNotification('success', '–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        showNotification('error', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}

function showNotification(type, message) {
    console.log('showNotification called with:', type, message);
    try {
        // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ  
        const alertClass = type === 'success' ? 'alert-success' : 
                         type === 'danger' ? 'alert-danger' : 
                         type === 'info' ? 'alert-info' : 'alert-warning';
        const icon = type === 'success' ? 'fa-check-circle' : 
                    type === 'danger' ? 'fa-exclamation-triangle' :
                    type === 'info' ? 'fa-info-circle' : 'fa-exclamation-triangle';
        
        const notification = document.createElement('div');
        notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            <i class="fas ${icon} me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    } catch (error) {
        console.error('Error in showNotification:', error);
        // Fallback to alert
        alert(`${type.toUpperCase()}: ${message}`);
    }
}

function reorderPortfolio() {
    console.log('reorderPortfolio called');
    if (typeof showNotification === 'function') {
        showNotification('–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    } else {
        alert('–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function importPortfolio() {
    console.log('importPortfolio called');
    if (typeof showNotification === 'function') {
        showNotification('–§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    } else {
        alert('–§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function exportPortfolio() {
    console.log('exportPortfolio called');
    if (typeof showNotification === 'function') {
        showNotification('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    } else {
        alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
window.setViewMode = setViewMode;
window.openPortfolioModal = openPortfolioModal;
window.editPortfolioItem = editPortfolioItem;
window.previewPortfolioItem = previewPortfolioItem;
window.openEditModal = openEditModal;
window.savePortfolioChanges = savePortfolioChanges;
window.showNotification = showNotification;
window.reorderPortfolio = reorderPortfolio;
window.importPortfolio = importPortfolio;
window.exportPortfolio = exportPortfolio;

// Initialize Portfolio Manager
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing Portfolio Manager...');
    try {
        new PortfolioManager();
        console.log('Portfolio Manager initialized successfully');
    } catch (error) {
        console.error('Error initializing Portfolio Manager:', error);
    }
});
</script>
{% endblock %}