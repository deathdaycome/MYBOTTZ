{% extends "base.html" %}

{% block title %}–ü—Ä–æ–µ–∫—Ç—ã - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block page_title %}üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏{% endblock %}

{% block extra_css %}
<style>
/* –ö—Ä–∞—Å–∏–≤—ã–π –±–µ–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ñ–æ–Ω–∞ –∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º */
html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background: linear-gradient(135deg, #f5f1eb 0%, #e8dcc6 25%, #f2e8d5 50%, #ede3d0 75%, #f9f5ef 100%);
    min-height: 100vh;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
#projectModal .modal-dialog {
    max-height: 90vh;
    margin: 1.75rem auto;
}

#projectModal .modal-content {
    max-height: 85vh;
    display: flex;
    flex-direction: column;
}

/* –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ï –ü–û–ó–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–ï MODAL-DIALOG */
/* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –í–°–ï —Å—Ç–∏–ª–∏ Bootstrap –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    z-index: 999999 !important;
    display: none;
    width: 100% !important;
    height: 100% !important;
    overflow: hidden !important;
    outline: 0 !important;
}

.modal.fade {
    opacity: 0;
    transition: opacity 0.15s linear;
}

.modal.show {
    display: block !important;
    opacity: 1;
}

/* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
.modal-backdrop {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    z-index: 999998 !important;
    width: 100% !important;
    height: 100% !important;
    background-color: #000 !important;
}

.modal-backdrop.fade {
    opacity: 0;
}

.modal-backdrop.show {
    opacity: 0.5;
}

/* –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï - –º–æ–¥–∞–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥ –í–°–ï–ì–î–ê –ø–æ —Ü–µ–Ω—Ç—Ä—É */
.modal-dialog {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    z-index: 999999 !important;
    width: auto !important;
    margin: 0 !important;
    transform: translate(-50%, -50%) !important;
    max-width: 90% !important;
    pointer-events: none !important;
}

.modal-dialog-centered {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
}

/* –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal-content {
    position: relative !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    pointer-events: auto !important;
    background-color: #fff !important;
    background-clip: padding-box !important;
    border: 1px solid rgba(0, 0, 0, 0.2) !important;
    border-radius: 0.5rem !important;
    outline: 0 !important;
    max-height: 90vh !important;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.modal-header {
    display: flex !important;
    flex-shrink: 0 !important;
    align-items: center !important;
    justify-content: space-between !important;
    padding: 1rem !important;
    border-bottom: 1px solid #dee2e6 !important;
    border-top-left-radius: calc(0.5rem - 1px) !important;
    border-top-right-radius: calc(0.5rem - 1px) !important;
}

/* –¢–µ–ª–æ */
.modal-body {
    position: relative !important;
    flex: 1 1 auto !important;
    padding: 1rem !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    max-height: calc(90vh - 130px) !important;
}

/* –ü–æ–¥–≤–∞–ª */
.modal-footer {
    display: flex !important;
    flex-wrap: wrap !important;
    flex-shrink: 0 !important;
    align-items: center !important;
    justify-content: flex-end !important;
    padding: 0.75rem !important;
    border-top: 1px solid #dee2e6 !important;
    border-bottom-right-radius: calc(0.5rem - 1px) !important;
    border-bottom-left-radius: calc(0.5rem - 1px) !important;
    gap: 0.5rem !important;
}

/* –†–∞–∑–º–µ—Ä—ã */
.modal-xl .modal-dialog {
    max-width: 1140px !important;
    width: 90% !important;
}

.modal-lg .modal-dialog {
    max-width: 800px !important;
    width: 80% !important;
}

/* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ body */
body.modal-open {
    overflow: hidden !important;
    padding-right: 0 !important;
}

/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
#projectModal .modal-dialog,
#editProjectModal .modal-dialog,
#createProjectModal .modal-dialog,
#projectFilesModal .modal-dialog {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    z-index: 999999 !important;
}

/* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
.container-fluid {
    max-width: 100% !important;
    padding-left: 15px !important;
    padding-right: 15px !important;
    margin: 0 !important;
}

.row {
    margin-left: 0 !important;
    margin-right: 0 !important;
}

.col, .col-* {
    padding-left: 10px !important;
    padding-right: 10px !important;
}

.content-wrapper {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    padding: 2rem;
    margin: 1rem;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ - —É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ */
.modal-backdrop {
    background-color: rgba(0, 0, 0, 0.5) !important;
    z-index: 9999 !important;
}

.modal {
    z-index: 10000 !important;
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
}

.modal.show {
    display: flex !important;
}

.modal-dialog {
    z-index: 10001 !important;
    margin: 0;
    max-width: 90%;
    width: auto;
    position: relative;
}

/* –†–∞–∑–º–µ—Ä—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
.modal-dialog.modal-sm {
    max-width: 400px;
}

.modal-dialog.modal-lg {
    max-width: 800px;
}

.modal-dialog.modal-xl {
    max-width: 1200px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
@media (max-width: 576px) {
    .modal-dialog {
        max-width: 95%;
        margin: 10px;
    }
}

.modal-content {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    border: none;
}

/* –§–∏–∫—Å–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
.modal-footer button {
    z-index: 10005 !important;
    position: relative !important;
    pointer-events: auto !important;
    cursor: pointer !important;
}

#createProjectBtn {
    z-index: 10010 !important;
    position: relative !important;
    pointer-events: auto !important;
    cursor: pointer !important;
}

/* –£–±–∏—Ä–∞–µ–º backdrop-filter —Å content-wrapper –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.content-wrapper {
    position: relative;
    z-index: 1;
    transition: backdrop-filter 0.3s ease;
}

.content-wrapper.modal-open {
    backdrop-filter: none !important;
    filter: none !important;
}

/* –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π backdrop */
.modal-backdrop {
    display: none !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal.fade .modal-dialog {
    transform: scale(0.8) !important;
    transition: transform 0.3s ease-out !important;
    opacity: 0;
}

.modal.show .modal-dialog {
    transform: scale(1) !important;
    opacity: 1;
}

.modal.fade {
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

.modal.show {
    opacity: 1;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ –∏–∫–æ–Ω–∫–∞–º–∏ */
.stat-card {
    background: linear-gradient(135deg, #ffffff 0%, #faf8f5 100%);
    border: none;
    border-radius: 16px;
    padding: 1.2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    text-align: center;
    min-height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--card-accent, #007bff);
    border-radius: 16px 16px 0 0;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.15);
}

.stat-card:hover .stat-icon {
    transform: scale(1.05);
}

.stat-card .stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.8rem;
    background: linear-gradient(135deg, var(--icon-bg, #007bff), var(--icon-bg-alt, #0056b3));
    color: white;
    font-size: 1.4rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: transform 0.2s ease;
}

.stat-card .stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1;
}

.stat-card .stat-label {
    color: #718096;
    font-size: 0.85rem;
    font-weight: 500;
    line-height: 1.2;
    text-align: center;
}

/* –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ */
.stat-card.projects { --card-accent: #3b82f6; --icon-bg: #3b82f6; --icon-bg-alt: #2563eb; }
.stat-card.active { --card-accent: #10b981; --icon-bg: #10b981; --icon-bg-alt: #059669; }
.stat-card.completed { --card-accent: #22c55e; --icon-bg: #22c55e; --icon-bg-alt: #16a34a; }
.stat-card.revenue { --card-accent: #f59e0b; --icon-bg: #f59e0b; --icon-bg-alt: #d97706; }
.stat-card.paid { --card-accent: #06b6d4; --icon-bg: #06b6d4; --icon-bg-alt: #0891b2; }
.stat-card.expenses { --card-accent: #ef4444; --icon-bg: #ef4444; --icon-bg-alt: #dc2626; }
.stat-card.profit { --card-accent: #8b5cf6; --icon-bg: #8b5cf6; --icon-bg-alt: #7c3aed; }
.stat-card.conversion { --card-accent: #f97316; --icon-bg: #f97316; --icon-bg-alt: #ea580c; }
.stat-card.debt { --card-accent: #ef4444; --icon-bg: #ef4444; --icon-bg-alt: #dc2626; }
.stat-card.profitability { --card-accent: #059669; --icon-bg: #059669; --icon-bg-alt: #047857; }

.timeline {
    position: relative;
    max-height: 300px;
    overflow-y: auto;
    padding: 0;
}

.timeline-item {
    position: relative;
    padding-left: 30px;
    margin-bottom: 20px;
    border-left: 2px solid #e2e8f0;
}

.timeline-item:before {
    content: '';
    position: absolute;
    left: -6px;
    top: 5px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--primary-color);
    border: 2px solid #fff;
    box-shadow: 0 0 0 2px #e2e8f0;
}

.timeline-item:last-child {
    border-left: 2px solid transparent;
    margin-bottom: 0;
}

.timeline-date {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 5px;
}

.timeline-content {
    background: #f8fafc;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.timeline-content strong {
    color: var(--primary-color);
}

.status-new { background-color: #0d6efd !important; color: #ffffff !important; border: 1px solid #0d6efd !important; }
.status-review { background-color: #fd7e14 !important; color: #ffffff !important; border: 1px solid #fd7e14 !important; }
.status-accepted { background-color: #198754 !important; color: #ffffff !important; border: 1px solid #198754 !important; }
.status-in_progress { background-color: #0dcaf0 !important; color: #000000 !important; border: 1px solid #0dcaf0 !important; }
.status-testing { background-color: #6f42c1 !important; color: #ffffff !important; border: 1px solid #6f42c1 !important; }
.status-completed { background-color: #20c997 !important; color: #ffffff !important; border: 1px solid #20c997 !important; }
.status-cancelled { background-color: #dc3545 !important; color: #ffffff !important; border: 1px solid #dc3545 !important; }
.status-on_hold { background-color: #6c757d !important; color: #ffffff !important; border: 1px solid #6c757d !important; }

/* –°—Ç–∞—Ç—É—Å—ã –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ */
.status-custom { background-color: #e91e63 !important; color: #ffffff !important; border: 1px solid #e91e63 !important; }

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stat-card.secondary {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    color: white;
    border: none;
}

.stat-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
@media (max-width: 768px) {
    .stat-card {
        margin-bottom: 1rem;
        min-height: 120px;
        padding: 1rem;
    }
    
    .stat-card .stat-icon {
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
        margin-bottom: 0.6rem;
    }
    
    .stat-card .stat-value {
        font-size: 1.5rem;
    }
    
    .stat-card .stat-label {
        font-size: 0.8rem;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤ */
.project-card-item {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-left: 4px solid #e9ecef;
}

.project-card-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

/* –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É */
.project-card[data-priority="low"] .project-card-item {
    border-left-color: #28a745; /* –ó–µ–ª–µ–Ω—ã–π - –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç */
}

.project-card[data-priority="normal"] .project-card-item {
    border-left-color: #007bff; /* –°–∏–Ω–∏–π - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç */
}

.project-card[data-priority="high"] .project-card-item {
    border-left-color: #fd7e14; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π - –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç */
}

.project-card[data-priority="urgent"] .project-card-item {
    border-left-color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π - —Å—Ä–æ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç */
    animation: pulse-urgent 2s infinite;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ */
@keyframes pulse-urgent {
    0% { box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3); }
    50% { box-shadow: 0 4px 16px rgba(220, 53, 69, 0.6); }
    100% { box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ */
.project-card {
    min-height: 350px;
    max-height: 400px;
    position: relative;
}

.project-card-item {
    min-height: 330px;
    max-height: 380px;
    display: flex;
    flex-direction: column;
}

/* –¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
.project-card.color-green {
    border-left: 5px solid #28a745;
    background: linear-gradient(90deg, rgba(40, 167, 69, 0.1) 0%, transparent 10%);
}

.project-card.color-yellow {
    border-left: 5px solid #ffc107;
    background: linear-gradient(90deg, rgba(255, 193, 7, 0.1) 0%, transparent 10%);
}

.project-card.color-red {
    border-left: 5px solid #dc3545;
    background: linear-gradient(90deg, rgba(220, 53, 69, 0.1) 0%, transparent 10%);
}

.project-card.color-default {
    border-left: 5px solid #6c757d;
}

/* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ü–≤–µ—Ç–∞ */
.color-indicator-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    z-index: 10;
    transition: all 0.3s;
}

.color-indicator-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.color-indicator-btn.green { background-color: #28a745; }
.color-indicator-btn.yellow { background-color: #ffc107; }
.color-indicator-btn.red { background-color: #dc3545; }
.color-indicator-btn.default { background-color: #6c757d; }

/* –¶–≤–µ—Ç–æ–≤—ã–µ –ø–æ–ª–æ—Å–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
tr.color-green td:first-child {
    border-left: 5px solid #28a745;
    padding-left: 10px;
}

tr.color-yellow td:first-child {
    border-left: 5px solid #ffc107;
    padding-left: 10px;
}

tr.color-red td:first-child {
    border-left: 5px solid #dc3545;
    padding-left: 10px;
}

tr.color-default td:first-child {
    border-left: 5px solid #6c757d;
    padding-left: 10px;
}

tr .project-color-indicator {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin-right: 8px;
    top: auto;
    right: auto;
}

.project-card-item .card-body {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.project-card-item .description-preview {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    line-clamp: 3;
    max-height: 60px;
    margin-bottom: 15px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è footer –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
.project-card-item .card-footer,
.project-card-item .mt-auto {
    margin-top: auto;
    padding-top: 10px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
.project-card-item .btn-group-sm .btn {
    padding: 0.25rem 0.4rem;
    font-size: 0.75rem;
    margin-right: 2px;
}

/* –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
.project-card-item .user-info {
    margin-bottom: 10px;
}

.project-card-item .badge {
    font-size: 0.7rem;
    padding: 0.25em 0.5em;
}

.project-card-item .progress {
    height: 4px;
    margin-bottom: 10px;
}

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ */
.badge[class*="status-"] {
    font-weight: 500 !important;
    padding: 0.5em 0.75em !important;
    border-radius: 0.375rem !important;
    font-size: 0.875rem !important;
    text-shadow: none !important;
    opacity: 1 !important;
}

/* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º Bootstrap —Å—Ç–∏–ª–∏ –¥–ª—è –±–æ–ª—å—à–µ–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ */
.badge {
    background-color: inherit !important;
    color: inherit !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º */
.description-container {
    transition: all 0.3s ease;
}

.description-container:hover {
    border-color: #007bff !important;
}

.description-container::-webkit-scrollbar {
    width: 8px;
}

.description-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.description-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

.description-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã */
.btn.w-100.d-flex {
    min-height: 38px;
    white-space: nowrap;
}

.btn.w-100.d-flex span {
    text-align: center;
    flex-grow: 1;
}
</style>
{% endblock %}

{% block header_actions %}
<div class="btn-group">
    {% if user_role == 'owner' %}
    <button class="btn btn-primary btn-custom" onclick="showCreateProjectModal();">
        <i class="fas fa-plus me-1"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
    </button>
    {% endif %}
    <button class="btn btn-secondary btn-custom" onclick="refreshProjects()">
        <i class="fas fa-sync-alt me-1"></i> –û–±–Ω–æ–≤–∏—Ç—å
    </button>
    {% if user_role == 'owner' %}
    <button class="btn btn-success btn-custom" onclick="exportProjects()">
        <i class="fas fa-download me-1"></i> –≠–∫—Å–ø–æ—Ä—Ç
    </button>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="content-wrapper">
<!-- Filters and Search -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="input-group">
                    <input type="text" class="form-control" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—É..." onkeyup="searchProjects()">
                    <button class="btn btn-outline-secondary" onclick="searchProjects()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="statusFilter" onchange="filterProjects()">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="new">–ù–æ–≤—ã–µ</option>
                    <option value="review">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                    <option value="accepted">–ü—Ä–∏–Ω—è—Ç—ã–µ</option>
                    <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                    <option value="testing">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                    <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="complexityFilter" onchange="filterProjects()">
                    <option value="">–í—Å–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</option>
                    <option value="simple">–ü—Ä–æ—Å—Ç—ã–µ</option>
                    <option value="medium">–°—Ä–µ–¥–Ω–∏–µ</option>
                    <option value="complex">–°–ª–æ–∂–Ω—ã–µ</option>
                    <option value="premium">–ü—Ä–µ–º–∏—É–º</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="sortBy" onchange="sortProjects()">
                    <option value="created_at">–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è</option>
                    <option value="updated_at">–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</option>
                    <option value="estimated_cost">–ü–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</option>
                    <option value="title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-outline-danger w-100 d-flex align-items-center justify-content-center" onclick="clearFilters()">
                    <i class="fas fa-times me-1"></i>
                    <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-2">
        <div class="stat-card projects">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-value" id="totalProjects">{{ projects|length }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card active">
            <div class="stat-icon">
                <i class="fas fa-rocket"></i>
            </div>
            <div class="stat-value" id="activeProjects">
                {{ projects|selectattr("status", "in", ["new", "review", "accepted", "in_progress", "testing"])|list|length }}
            </div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card completed">
            <div class="stat-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-value" id="completedProjects">
                {{ projects|selectattr("status", "equalto", "completed")|list|length }}
            </div>
            <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card revenue">
            <div class="stat-icon">
                <i class="fas fa-gem"></i>
            </div>
            <div class="stat-value" id="totalRevenue">
                {{ "{:,}".format((projects|selectattr("estimated_cost")|sum(attribute="estimated_cost") or 0)|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card paid">
            <div class="stat-icon">
                <i class="fas fa-credit-card"></i>
            </div>
            <div class="stat-value" id="totalPaid">
                {{ "{:,}".format((projects|selectattr("client_paid_total")|sum(attribute="client_paid_total") or 0)|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card debt">
            <div class="stat-icon">
                <i class="fas fa-clock-o"></i>
            </div>
            <div class="stat-value" id="remainingPayment">
                {{ "{:,}".format(((projects|selectattr("estimated_cost")|sum(attribute="estimated_cost") or 0) - (projects|selectattr("client_paid_total")|sum(attribute="client_paid_total") or 0))|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–û—Å—Ç–∞—Ç–æ–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º</div>
        </div>
    </div>
</div>

<!-- Financial Statistics Row -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card expenses">
            <div class="stat-icon">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <div class="stat-value" id="totalPrepayments">
                {{ "{:,}".format((projects|selectattr("prepayment_amount")|sum(attribute="prepayment_amount") or 0)|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–û–±—â–∏–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card conversion">
            <div class="stat-icon">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="stat-value" id="totalExecutorPayments">
                {{ "{:,}".format((projects|selectattr("executor_paid_total")|sum(attribute="executor_paid_total") or 0)|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–í—ã–ø–ª–∞—á–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card debt">
            <div class="stat-icon">
                <i class="fas fa-stopwatch"></i>
            </div>
            <div class="stat-value" id="remainingExecutorPayments">
                {{ "{:,}".format(((projects|selectattr("executor_cost")|sum(attribute="executor_cost") or 0) - (projects|selectattr("executor_paid_total")|sum(attribute="executor_paid_total") or 0))|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–û—Å—Ç–∞—Ç–æ–∫ –∫ –≤—ã–ø–ª–∞—Ç–µ</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card profit">
            <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-value" id="profit">
                {{ "{:,}".format(((projects|selectattr("client_paid_total")|sum(attribute="client_paid_total") or 0) - (projects|selectattr("executor_paid_total")|sum(attribute="executor_paid_total") or 0))|round|int).replace(",", " ") }}‚ÇΩ
            </div>
            <div class="stat-label">–¢–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
        </div>
    </div>
</div>

<!-- Projects Table -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</h5>
        <div class="d-flex align-items-center">
            <span class="me-3 text-muted" id="projectsCount">–ü–æ–∫–∞–∑–∞–Ω–æ: {{ projects|length }}</span>
            <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-secondary" onclick="changeView('table')" id="tableView">
                    <i class="fas fa-table"></i>
                </button>
                <button class="btn btn-outline-secondary" onclick="changeView('cards')" id="cardsView">
                    <i class="fas fa-th-large"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body p-0">
        <!-- Table View -->
        <div id="tableViewContainer">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="projectsTable">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                            <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr data-project-id="{{ project.id }}" data-status="{{ project.status }}" data-complexity="{{ project.complexity }}" class="color-{{ project.get('color', 'default') }}">
                            <td>
                                <span class="badge bg-secondary">#{{ project.id }}</span>
                            </td>
                            <td>
                                <div class="fw-bold text-truncate" style="max-width: 200px;" title="{{ project.title }}">
                                    {{ project.title }}
                                </div>
                                <small class="text-muted">{{ project.project_type or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</small>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="user-avatar me-2">
                                        {{ (project.user.first_name or 'U')[0] if project.user else 'U' }}
                                    </div>
                                    <div>
                                        <div class="fw-medium">{{ project.user.first_name or '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' if project.user else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</div>
                                        <small class="text-muted">@{{ project.user.username or '–Ω–µ—Ç' if project.user else '–Ω–µ—Ç' }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="me-2">
                                        <span class="badge status-{{ project.status }}">
                                            {% if project.status == 'new' %}üÜï –ù–æ–≤—ã–π
                                            {% elif project.status == 'review' %}üëÄ –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ
                                            {% elif project.status == 'accepted' %}‚úÖ –ü—Ä–∏–Ω—è—Ç
                                            {% elif project.status == 'in_progress' %}üîÑ –í —Ä–∞–±–æ—Ç–µ
                                            {% elif project.status == 'testing' %}üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                                            {% elif project.status == 'completed' %}üéâ –ó–∞–≤–µ—Ä—à–µ–Ω
                                            {% elif project.status == 'cancelled' %}‚ùå –û—Ç–º–µ–Ω–µ–Ω
                                            {% elif project.status == 'on_hold' %}‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                                            {% else %}{{ project.status }}{% endif %}
                                        </span>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm" onclick="showStatusChangeDialog({{ project.id }}, '{{ project.status }}')" title="–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                <div class="progress mt-1" style="height: 4px;">
                                    <div class="progress-bar" role="progressbar" style="width: {{ calculate_progress(project.status) }}%" data-project-id="{{ project.id }}">
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge complexity-{{ project.complexity }}">
                                    {% if project.complexity == 'simple' %}üü¢ –ü—Ä–æ—Å—Ç–æ–π
                                    {% elif project.complexity == 'medium' %}üü° –°—Ä–µ–¥–Ω–∏–π
                                    {% elif project.complexity == 'complex' %}üü† –°–ª–æ–∂–Ω—ã–π
                                    {% elif project.complexity == 'premium' %}üî¥ –ü—Ä–µ–º–∏—É–º
                                    {% else %}{{ project.complexity }}{% endif %}
                                </span>
                                                    </td>
                        <td>
                            {% if user_role == 'owner' %}
                                <div class="fw-bold">{{ (project.estimated_cost or 0)|round|int }}‚ÇΩ</div>
                                {% if project.final_cost and project.final_cost != project.estimated_cost %}
                                <small class="text-success">–§–∏–Ω–∞–ª: {{ (project.final_cost)|round|int }}‚ÇΩ</small>
                                {% endif %}
                            {% else %}
                                <div class="fw-bold">{{ (project.executor_cost or 0)|round|int }}‚ÇΩ</div>
                                <small class="text-success">–í—ã–ø–ª–∞—á–µ–Ω–æ: {{ (project.executor_paid_total or 0)|round|int }}‚ÇΩ</small>
                            {% endif %}
                        </td>
                        <td>
                            <div>{{ project.created_at[:10] if project.created_at else '–ù/–î' }}</div>
                            <small class="text-muted">{{ project.created_at[11:16] if project.created_at else '' }}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewProject({{ project.id }})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="window.location.href='/admin/projects/{{ project.id }}/detail'" title="–î–µ—Ç–∞–ª–∏">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="openEditModal({{ project.id }})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showFilesModal({{ project.id }})" title="–§–∞–π–ª—ã">
                                    <i class="fas fa-file"></i>
                                </button>
                                {% if project.user and project.user.telegram_id %}
                                <button class="btn btn-outline-success" onclick="contactClient({{ project.user.telegram_id }})" title="–°–≤—è–∑–∞—Ç—å—Å—è">
                                    <i class="fas fa-comment"></i>
                                </button>
                                {% else %}
                                <button class="btn btn-outline-secondary" disabled title="Telegram ID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç">
                                    <i class="fas fa-comment"></i>
                                </button>
                                {% endif %}
                                <button class="btn btn-outline-danger" onclick="confirmDeleteProject({{ project.id }}, '{{ project.title | replace("'", "\\'") | replace('"', '\\"') }}')" title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Cards View -->
    <div id="cardsViewContainer" class="d-none">
        <div class="row p-3" id="projectsCards">
            {% for project in projects %}
            <div class="col-md-6 col-lg-4 mb-4 project-card color-{{ project.get('color', 'default') }}" data-project-id="{{ project.id }}" data-status="{{ project.status }}" data-complexity="{{ project.complexity }}" data-priority="{{ project.priority }}" data-title="{{ project.title.lower() }}" data-client="{{ (project.user.first_name or '').lower() }}">
                <div class="card h-100 shadow-sm project-card-item" style="position: relative;">
                    <button class="color-indicator-btn {{ project.get('color', 'default') }}" 
                          onclick="changeProjectColor({{ project.id }}, '{{ project.get('color', 'default') }}'); event.stopPropagation();"
                          title="–ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é –º–µ—Ç–∫—É"></button>
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 text-truncate" title="{{ project.title }}">{{ project.title }}</h6>
                        <span class="badge bg-secondary">#{{ project.id }}</span>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-2 user-info">
                            <div class="user-avatar me-2">
                                {{ (project.user.first_name or 'U')[0] if project.user else 'U' }}
                            </div>
                            <div>
                                <div class="fw-medium">{{ project.user.first_name or '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' if project.user else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</div>
                                <small class="text-muted">@{{ project.user.username or '–Ω–µ—Ç' if project.user else '–Ω–µ—Ç' }}</small>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge status-{{ project.status }}">
                                {% if project.status == 'new' %}üÜï –ù–æ–≤—ã–π
                                {% elif project.status == 'review' %}üëÄ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                                {% elif project.status == 'accepted' %}‚úÖ –ü—Ä–∏–Ω—è—Ç
                                {% elif project.status == 'in_progress' %}üîÑ –í —Ä–∞–±–æ—Ç–µ
                                {% elif project.status == 'testing' %}üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                                {% elif project.status == 'completed' %}üéâ –ó–∞–≤–µ—Ä—à–µ–Ω
                                {% elif project.status == 'cancelled' %}‚ùå –û—Ç–º–µ–Ω–µ–Ω
                                {% elif project.status == 'on_hold' %}‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                                {% else %}{{ project.status }}{% endif %}
                            </span>
                            <span class="badge complexity-{{ project.complexity }}">
                                {% if project.complexity == 'simple' %}üü¢ –ü—Ä–æ—Å—Ç–æ–π
                                {% elif project.complexity == 'medium' %}üü° –°—Ä–µ–¥–Ω–∏–π
                                {% elif project.complexity == 'complex' %}üü† –°–ª–æ–∂–Ω—ã–π
                                {% elif project.complexity == 'premium' %}üî¥ –ü—Ä–µ–º–∏—É–º
                                {% else %}{{ project.complexity }}{% endif %}
                            </span>
                        </div>

                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" style="width: {{ calculate_progress(project.status) }}%;" aria-valuenow="{{ calculate_progress(project.status) }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>

                        <p class="card-text text-muted small description-preview">{{ project.description if project.description else '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}</p>

                        <div class="d-flex justify-content-between mt-auto">
                            <div class="fw-bold">{{ (project.estimated_cost or 0)|round|int }}‚ÇΩ</div>
                            <small class="text-muted">{{ project.created_at[:10] if project.created_at else '–ù/–î' }}</small>
                        </div>
                    </div>
                    <div class="card-footer bg-light d-flex justify-content-end">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewProject({{ project.id }})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="window.location.href='/admin/projects/{{ project.id }}/detail'" title="–î–µ—Ç–∞–ª–∏">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="btn btn-outline-info" onclick="openEditModal({{ project.id }})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="showFilesModal({{ project.id }})" title="–§–∞–π–ª—ã">
                                <i class="fas fa-folder-open"></i>
                            </button>
                            {% if project.user and project.user.telegram_id %}
                            <button class="btn btn-outline-success" onclick="contactClient({{ project.user.telegram_id }})" title="–°–≤—è–∑–∞—Ç—å—Å—è">
                                <i class="fas fa-comment"></i>
                            </button>
                            {% else %}
                            <button class="btn btn-outline-secondary" disabled title="Telegram ID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç">
                                <i class="fas fa-comment"></i>
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Project Details Modal -->
<div class="modal fade" id="projectModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="projectModalBody">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-primary" onclick="editCurrentProject()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Project Modal -->
<div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProjectModalLabel">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editProjectForm">
                    <input type="hidden" id="editProjectId">
                    <div class="mb-3">
                        <label for="editProjectTitle" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                        <input type="text" class="form-control" id="editProjectTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="editProjectDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="editProjectDescription" rows="4"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectType" class="form-label">–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞</label>
                            <select class="form-select" id="editProjectType">
                                <option value="web">–í–µ–±-—Å–∞–π—Ç</option>
                                <option value="bot">Telegram Bot</option>
                                <option value="mobile">–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</option>
                                <option value="desktop">–î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</option>
                                <option value="integration">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</option>
                                <option value="consultation">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
                                <option value="other">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectStatus" class="form-label">–°—Ç–∞—Ç—É—Å</label>
                            <select class="form-select" id="editProjectStatus">
                                <option value="new">–ù–æ–≤—ã–π</option>
                                <option value="review">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                                <option value="accepted">–ü—Ä–∏–Ω—è—Ç</option>
                                <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                                <option value="testing">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                                <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
                                <option value="on_hold">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectComplexity" class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                            <select class="form-select" id="editProjectComplexity">
                                <option value="simple">–ü—Ä–æ—Å—Ç–æ–π</option>
                                <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                                <option value="complex">–°–ª–æ–∂–Ω—ã–π</option>
                                <option value="premium">–ü—Ä–µ–º–∏—É–º</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectPriority" class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                            <select class="form-select" id="editProjectPriority">
                                <option value="low">–ù–∏–∑–∫–∏–π</option>
                                <option value="normal">–û–±—ã—á–Ω—ã–π</option>
                                <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                                <option value="urgent">–°—Ä–æ—á–Ω—ã–π</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectEstimatedCost" class="form-label">–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectEstimatedCost" min="0" step="1000">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectExecutorCost" class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectExecutorCost" min="0" step="500">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectFinalCost" class="form-label">–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectFinalCost" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectEstimatedHours" class="form-label">–ß–∞—Å—ã (–ø—Ä–æ–≥–Ω–æ–∑)</label>
                            <input type="number" class="form-control" id="editProjectEstimatedHours" min="1" step="1">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectPrepaymentAmount" class="form-label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectPrepaymentAmount" min="0" step="1000">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectClientPaidTotal" class="form-label">–£–∂–µ –∑–∞–ø–ª–∞—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectClientPaidTotal" min="0" step="1000">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectExecutorPaidTotal" class="form-label">–í—ã–ø–ª–∞—á–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é (‚ÇΩ)</label>
                            <input type="number" class="form-control" id="editProjectExecutorPaidTotal" min="0" step="500">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProjectAssignedExecutor" class="form-label">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</label>
                            <select class="form-select" id="editProjectAssignedExecutor">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProjectDeadline" class="form-label">–î–µ–¥–ª–∞–π–Ω</label>
                            <input type="datetime-local" class="form-control" id="editProjectDeadline">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="submitProjectEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞ -->
<div class="modal fade" id="changeStatusModal" tabindex="-1" aria-labelledby="changeStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeStatusModalLabel">–°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="changeStatusProjectId" />
                
                <div class="mb-3">
                    <label class="form-label">–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</label>
                    <div id="changeStatusCurrentStatus" class="fw-bold text-primary"></div>
                </div>
                
                <div class="mb-3">
                    <label for="changeStatusNewStatus" class="form-label">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:</label>
                    <select class="form-select" id="changeStatusNewStatus" onchange="updateSelectedStatusName()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å...</option>
                    </select>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="useCustomStatus" onchange="toggleCustomStatus()">
                        <label class="form-check-label" for="useCustomStatus">
                            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
                        </label>
                    </div>
                </div>
                
                <div class="mb-3 d-none" id="customStatusGroup">
                    <label for="customStatusName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞:</label>
                    <input type="text" class="form-control" id="customStatusName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞" onkeyup="updateSelectedStatusName()">
                    <small class="form-text text-muted">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º—É</small>
                </div>
                
                <div class="mb-3">
                    <label for="changeStatusComment" class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <textarea class="form-control" id="changeStatusComment" rows="3" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Å—Ç–∞—Ç—É—Å–∞..."></textarea>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ "<span id="selectedStatusName">–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>"?
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="confirmStatusChange()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ -->
<div class="modal fade" id="deleteProjectModal" tabindex="-1" aria-labelledby="deleteProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteProjectModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="deleteProjectId" />
                
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.
                </div>
                
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç <strong id="deleteProjectTitle"></strong>?</p>
                
                <p class="text-muted">
                    <small>–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∞–Ω–Ω—ã–µ. –ó–∞–∫–∞–∑—á–∏–∫ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏.</small>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" onclick="deleteProject()">
                    <i class="fas fa-trash me-2"></i>–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Create Project Modal - –£–î–ê–õ–ï–ù–û, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->

<!-- Project Files Modal -->
<div class="modal fade" id="projectFilesModal" tabindex="-1" aria-labelledby="projectFilesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="projectFilesModalLabel">
                    <i class="fas fa-file me-2"></i>–§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="projectFilesContent">
                    <div class="text-center p-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞...</p>
                    </div>
                </div>
                
                <div class="mt-4 border-top pt-3">
                    <h5><i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</h5>
                    <form id="uploadProjectFileForm" enctype="multipart/form-data">
                        <input type="hidden" id="uploadProjectId" name="project_id">
                        <div class="mb-3">
                            <label for="projectFileUpload" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
                            <input class="form-control" type="file" id="projectFileUpload" name="file">
                        </div>
                        <div class="mb-3">
                            <label for="projectFileDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</label>
                            <input type="text" class="form-control" id="projectFileDescription" name="description" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞">
                        </div>
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" onclick="uploadProjectFile()">
                                <i class="fas fa-upload me-1"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

    let currentProjectId = null;
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑ const
    window.username = 'admin';
    window.password = 'qwerty123';

    let currentView = 'table';
    let allProjects = {{ projects|tojson|safe }};
    let filteredProjects = [...allProjects];
    let projectStatuses = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

    // View Management
    function changeView(view) {
        currentView = view;
        
        if (view === 'table') {
            document.getElementById('tableViewContainer').style.display = 'block';
            document.getElementById('cardsViewContainer').style.display = 'none';
            document.getElementById('tableView').classList.add('active');
            document.getElementById('cardsView').classList.remove('active');
        } else {
            document.getElementById('tableViewContainer').style.display = 'none';
            document.getElementById('cardsViewContainer').style.display = 'block';
            document.getElementById('tableView').classList.remove('active');
            document.getElementById('cardsView').classList.add('active');
        }
    }

    // Search and Filter
    function searchProjects() {
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const complexityFilter = document.getElementById('complexityFilter');
        
        if (!searchInput || !statusFilter || !complexityFilter) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            return;
        }
        
        const searchTerm = searchInput.value.toLowerCase();
        const statusFilterValue = statusFilter.value;
        const complexityFilterValue = complexityFilter.value;

        filteredProjects = allProjects.filter(project => {
            const matchesSearch = !searchTerm || 
                project.title.toLowerCase().includes(searchTerm) ||
                (project.user && project.user.first_name && project.user.first_name.toLowerCase().includes(searchTerm));
            
            const matchesStatus = !statusFilterValue || project.status === statusFilterValue;
            const matchesComplexity = !complexityFilterValue || project.complexity === complexityFilterValue;

            return matchesSearch && matchesStatus && matchesComplexity;
        });

        updateProjectsDisplay();
    }

    function filterProjects() {
        searchProjects(); // Reuse search logic
    }

    function clearFilters() {
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const complexityFilter = document.getElementById('complexityFilter');
        
        if (searchInput) searchInput.value = '';
        if (statusFilter) statusFilter.value = '';
        if (complexityFilter) complexityFilter.value = '';
        
        filteredProjects = [...allProjects];
        updateProjectsDisplay();
    }

    function sortProjects() {
        const sortByElement = document.getElementById('sortBy');
        if (!sortByElement) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç sortBy –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        const sortBy = sortByElement.value;
        
        filteredProjects.sort((a, b) => {
            if (sortBy === 'created_at' || sortBy === 'updated_at') {
                return new Date(b[sortBy]) - new Date(a[sortBy]);
            } else if (sortBy === 'estimated_cost') {
                return (b.estimated_cost || 0) - (a.estimated_cost || 0);
            } else if (sortBy === 'title') {
                return a.title.localeCompare(b.title);
            }
            return 0;
        });

        updateProjectsDisplay();
    }

    function updateProjectsDisplay() {
        const projectsCount = document.getElementById('projectsCount');
        if (projectsCount) {
            projectsCount.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ: ${filteredProjects.length}`;
        }
        
        if (currentView === 'table') {
            updateTableView();
        } else {
            updateCardsView();
        }
    }

    function updateTableView() {
        // Hide all rows first
        const rows = document.querySelectorAll('#projectsTable tbody tr');
        rows.forEach(row => row.style.display = 'none');

        // Show filtered rows
        filteredProjects.forEach(project => {
            const row = document.querySelector(`tr[data-project-id="${project.id}"]`);
            if (row) {
                row.style.display = '';
            }
        });
    }

    function updateCardsView() {
        // Hide all cards first
        const cards = document.querySelectorAll('#projectsCards .project-card');
        cards.forEach(card => card.style.display = 'none');

        // Show filtered cards
        filteredProjects.forEach(project => {
            const card = document.querySelector(`.project-card[data-project-id="${project.id}"]`);
            if (card) {
                card.style.display = '';
            }
        });
    }

    async function changeProjectColor(projectId, currentColor) {
        const colors = ['default', 'green', 'yellow', 'red'];
        const colorNames = {
            'default': '–°–µ—Ä—ã–π',
            'green': '–ó–µ–ª–µ–Ω—ã–π', 
            'yellow': '–ñ–µ–ª—Ç—ã–π',
            'red': '–ö—Ä–∞—Å–Ω—ã–π'
        };
        
        // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π —Ü–≤–µ—Ç
        const currentIndex = colors.indexOf(currentColor);
        const nextColor = colors[(currentIndex + 1) % colors.length];
        
        try {
            const response = await fetch(`/admin/api/projects/${projectId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({ color: nextColor })
            });
            
            if (response.ok) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–æ–µ–∫—Ç–∞
                const projectCard = document.querySelector(`.project-card[data-project-id="${projectId}"]`);
                if (projectCard) {
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∫–ª–∞—Å—Å —Ü–≤–µ—Ç–∞
                    projectCard.classList.remove('color-default', 'color-green', 'color-yellow', 'color-red');
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å —Ü–≤–µ—Ç–∞
                    projectCard.classList.add(`color-${nextColor}`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                    const colorBtn = projectCard.querySelector('.color-indicator-btn');
                    if (colorBtn) {
                        colorBtn.className = `color-indicator-btn ${nextColor}`;
                        colorBtn.setAttribute('onclick', `changeProjectColor(${projectId}, '${nextColor}'); event.stopPropagation();`);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ
                const tableRow = document.querySelector(`tr[data-project-id="${projectId}"]`);
                if (tableRow) {
                    tableRow.classList.remove('color-default', 'color-green', 'color-yellow', 'color-red');
                    tableRow.classList.add(`color-${nextColor}`);
                }
                
                showNotification(`–¶–≤–µ—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ ${colorNames[nextColor]}`, 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞', 'danger');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞', 'danger');
        }
    }
    
    function showNotification(message, type = 'info') {
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        let notificationContainer = document.getElementById('notification-container');
        if (!notificationContainer) {
            notificationContainer = document.createElement('div');
            notificationContainer.id = 'notification-container';
            notificationContainer.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                max-width: 400px;
            `;
            document.body.appendChild(notificationContainer);
        }
        
        // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show`;
        notification.style.cssText = `
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        `;
        
        const iconMap = {
            'success': 'fas fa-check-circle',
            'danger': 'fas fa-exclamation-circle',
            'warning': 'fas fa-exclamation-triangle',
            'info': 'fas fa-info-circle'
        };
        
        notification.innerHTML = `
            <i class="${iconMap[type] || iconMap.info} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        notificationContainer.appendChild(notification);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 150);
            }
        }, 5000);
    }

    // Project Management
    async function updateStatus(projectId, newStatus, comment = '') {
        try {
            const response = await fetch(`/admin/api/projects/${projectId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa(`${username}:${password}`)
                },
                body: JSON.stringify({ status: newStatus, comment })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ UI
                updateStatusInUI(projectId, newStatus);
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                updateProgressBar(projectId, newStatus);
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞.', 'danger');
            }
        } catch (error) {
            showNotification('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message, 'danger');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –¥–ª—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    async function loadExecutorsForEdit() {
        try {
            const response = await fetch('/admin/api/users/executors', {
                method: 'GET',
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                const executorSelect = document.getElementById('editProjectAssignedExecutor');
                
                if (executorSelect && data.executors) {
                    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ "–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è")
                    while (executorSelect.children.length > 1) {
                        executorSelect.removeChild(executorSelect.lastChild);
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
                    data.executors.forEach(executor => {
                        const option = document.createElement('option');
                        option.value = executor.id;
                        option.textContent = `${executor.first_name || executor.username} (${executor.username})`;
                        executorSelect.appendChild(option);
                    });
                }
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
    async function loadExecutors() {
        console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π...');
        try {
            const response = await fetch('/admin/api/users/executors', {
                method: 'GET',
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            console.log('–û—Ç–≤–µ—Ç –æ—Ç API:', response.status);
            
            if (response.ok) {
                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
                
                const executorSelect = document.getElementById('createAssignedExecutor');
                console.log('–≠–ª–µ–º–µ–Ω—Ç select –Ω–∞–π–¥–µ–Ω:', executorSelect);
                
                if (executorSelect) {
                    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
                    executorSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>';
                    
                    if (data.executors && data.executors.length > 0) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
                        data.executors.forEach(executor => {
                            const option = document.createElement('option');
                            option.value = executor.id;
                            const name = executor.first_name || executor.full_name || executor.username;
                            const role = executor.role || '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å';
                            option.textContent = `${name} (${role})`;
                            executorSelect.appendChild(option);
                        });
                        console.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${data.executors.length} –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π`);
                    } else if (data.users && data.users.length > 0) {
                        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –ø–æ–ª–µ users
                        data.users.forEach(user => {
                            if (user.role === 'executor' || user.role === 'admin') {
                                const option = document.createElement('option');
                                option.value = user.id;
                                const name = user.first_name || user.full_name || user.username;
                                option.textContent = `${name} (${user.role})`;
                                executorSelect.appendChild(option);
                            }
                        });
                        console.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏–∑ users`);
                    } else {
                        console.warn('–°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ø—É—Å—Ç');
                        executorSelect.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</option>';
                    }
                } else {
                    console.error('–≠–ª–µ–º–µ–Ω—Ç select –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }
            } else {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
                const errorText = await response.text();
                console.error('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorText);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:', error);
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        initializeFilters();
        changeView(currentView);
        sortProjects();
        loadProjectStatuses();
        loadExecutors();
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function initializeFilters() {
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const complexityFilter = document.getElementById('complexityFilter');
        const sortBy = document.getElementById('sortBy');
        
        if (!searchInput || !statusFilter || !complexityFilter || !sortBy) {
            console.error('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            return;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –æ–ø—Ü–∏—è–º–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ
        if (statusFilter.children.length <= 1) {
            const statusOptions = [
                { value: '', text: '–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã' },
                { value: 'new', text: '–ù–æ–≤—ã–µ' },
                { value: 'review', text: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏' },
                { value: 'accepted', text: '–ü—Ä–∏–Ω—è—Ç—ã–µ' },
                { value: 'in_progress', text: '–í —Ä–∞–±–æ—Ç–µ' },
                { value: 'testing', text: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' },
                { value: 'completed', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ' },
                { value: 'cancelled', text: '–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ' },
                { value: 'on_hold', text: '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ' }
            ];
            
            statusOptions.forEach(option => {
                if (!statusFilter.querySelector(`option[value="${option.value}"]`)) {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    statusFilter.appendChild(opt);
                }
            });
        }
        
        if (complexityFilter.children.length <= 1) {
            const complexityOptions = [
                { value: '', text: '–í—Å–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏' },
                { value: 'simple', text: '–ü—Ä–æ—Å—Ç—ã–µ' },
                { value: 'medium', text: '–°—Ä–µ–¥–Ω–∏–µ' },
                { value: 'complex', text: '–°–ª–æ–∂–Ω—ã–µ' },
                { value: 'premium', text: '–ü—Ä–µ–º–∏—É–º' }
            ];
            
            complexityOptions.forEach(option => {
                if (!complexityFilter.querySelector(`option[value="${option.value}"]`)) {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    complexityFilter.appendChild(opt);
                }
            });
        }
        
        if (sortBy.children.length <= 1) {
            const sortOptions = [
                { value: 'created_at', text: '–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è' },
                { value: 'updated_at', text: '–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' },
                { value: 'estimated_cost', text: '–ü–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏' },
                { value: 'title', text: '–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é' }
            ];
            
            sortOptions.forEach(option => {
                if (!sortBy.querySelector(`option[value="${option.value}"]`)) {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    sortBy.appendChild(opt);
                }
            });
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
    async function loadProjectStatuses() {
        try {
            const response = await fetch('/admin/api/project-statuses/', {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    projectStatuses = data.data;
                    applyCustomStatusStyles();
                }
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤:', error);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CSS –∫–ª–∞—Å—Å–∞ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
    function createStatusClass(statusName) {
        return 'status-' + statusName.toLowerCase()
            .replace(/\s+/g, '_')
            .replace(/[^\w_]/g, '')
            .replace(/_+/g, '_');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –∫ –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å—Ç–∞—Ç—É—Å–∞–º
    function applyCustomStatusStyles() {
        // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ —Ü–≤–µ—Ç–∞
        const style = document.createElement('style');
        let css = '';
        
        projectStatuses.forEach(status => {
            const className = createStatusClass(status.name);
            const color = status.color || '#6c757d';
            
            css += `
                .${className} {
                    background-color: ${color} !important;
                    color: #ffffff !important;
                    border: 1px solid ${color} !important;
                    font-weight: 500 !important;
                    padding: 0.5em 0.75em !important;
                    border-radius: 0.375rem !important;
                    font-size: 0.875rem !important;
                    display: inline-flex !important;
                    align-items: center !important;
                    gap: 0.25rem !important;
                    transition: all 0.2s ease !important;
                    text-shadow: none !important;
                    opacity: 1 !important;
                }
                
                .${className}:hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
                    filter: brightness(1.1) !important;
                }
            `;
        });
        
        style.textContent = css;
        document.head.appendChild(style);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        updateStatusDisplay();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
    function updateStatusDisplay() {
        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö –∫–ª–∞—Å—Å—ã
        const statusBadges = document.querySelectorAll('.badge[class*="status-"]');
        
        statusBadges.forEach(badge => {
            const statusText = badge.textContent.trim();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å –≤ –Ω–∞—à–µ–º —Å–ø–∏—Å–∫–µ
            const matchingStatus = projectStatuses.find(status => 
                statusText.includes(status.name) || 
                badge.classList.contains(`status-${status.id}`)
            );
            
            if (matchingStatus) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–∞—Å—Å—ã —Å—Ç–∞—Ç—É—Å–æ–≤
                badge.className = badge.className.replace(/\bstatus-[^\s]*/g, '');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
                const newClass = createStatusClass(matchingStatus.name);
                badge.classList.add('badge', newClass);
            }
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
    function showStatusChangeDialog(projectId, currentStatus) {
        document.getElementById('changeStatusProjectId').value = projectId;
        document.getElementById('changeStatusCurrentStatus').textContent = getStatusName(currentStatus);
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç—É—Å–∞–º–∏
        const statusSelect = document.getElementById('changeStatusNewStatus');
        statusSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å...</option>';
        
        projectStatuses.forEach(status => {
            if (status.name.toLowerCase() !== currentStatus) {
                const option = document.createElement('option');
                option.value = status.id;
                option.textContent = status.name;
                statusSelect.appendChild(option);
            }
        });
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
        document.getElementById('changeStatusComment').value = '';
        document.getElementById('useCustomStatus').checked = false;
        document.getElementById('customStatusGroup').classList.add('d-none');
        document.getElementById('customStatusName').value = '';
        statusSelect.disabled = false;
        
        updateSelectedStatusName();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = new bootstrap.Modal(document.getElementById('changeStatusModal'));
        modal.show();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ–≥–æ –∏–º–µ–Ω–∏ —Å—Ç–∞—Ç—É—Å–∞
    function getStatusName(status) {
        const statusNames = {
            'new': 'üÜï –ù–æ–≤—ã–π',
            'review': 'üëÄ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
            'accepted': '‚úÖ –ü—Ä–∏–Ω—è—Ç',
            'in_progress': 'üîÑ –í —Ä–∞–±–æ—Ç–µ',
            'testing': 'üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
            'completed': 'üéâ –ó–∞–≤–µ—Ä—à–µ–Ω',
            'cancelled': '‚ùå –û—Ç–º–µ–Ω–µ–Ω',
            'on_hold': '‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'
        };
        return statusNames[status] || status;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    function toggleCustomStatus() {
        const useCustom = document.getElementById('useCustomStatus').checked;
        const customGroup = document.getElementById('customStatusGroup');
        const statusSelect = document.getElementById('changeStatusNewStatus');
        
        if (useCustom) {
            customGroup.classList.remove('d-none');
            statusSelect.disabled = true;
            statusSelect.value = '';
        } else {
            customGroup.classList.add('d-none');
            statusSelect.disabled = false;
            document.getElementById('customStatusName').value = '';
        }
        
        updateSelectedStatusName();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    function updateSelectedStatusName() {
        const useCustom = document.getElementById('useCustomStatus').checked;
        const selectedStatusName = document.getElementById('selectedStatusName');
        
        if (useCustom) {
            const customName = document.getElementById('customStatusName').value;
            selectedStatusName.textContent = customName || '–Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å';
        } else {
            const statusSelect = document.getElementById('changeStatusNewStatus');
            const selectedOption = statusSelect.options[statusSelect.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                selectedStatusName.textContent = selectedOption.text;
            } else {
                selectedStatusName.textContent = '—Å—Ç–∞—Ç—É—Å';
            }
        }
    }





    function calculateProgress(status) {
        const statusProgress = {
            'new': 10,
            'review': 25,
            'accepted': 40,
            'in_progress': 60,
            'testing': 80,
            'completed': 100,
            'cancelled': 0,
            'on_hold': 50
        };
        return statusProgress[status] || 0;
    }

    async function openEditModal(projectId) {
        try {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å  
            const oldModal = bootstrap.Modal.getInstance(document.getElementById('editProjectModal'));
            if (oldModal) {
                oldModal.hide();
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
            const executorsResponse = await fetch('/admin/api/users/executors', {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            let executorsOptions = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>';
            if (executorsResponse.ok) {
                const executorsData = await executorsResponse.json();
                if (executorsData.success && executorsData.executors) {
                    executorsData.executors.forEach(executor => {
                        executorsOptions += `<option value="${executor.id}">${executor.first_name || ''} ${executor.last_name || ''} (@${executor.username})</option>`;
                    });
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
            const response = await fetch(`/admin/api/projects/${projectId}`, {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            const data = await response.json();
            if (data.success && data.project) {
                const project = data.project;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è datetime-local input
                let formattedDeadline = '';
                if (project.deadline) {
                    const deadline = new Date(project.deadline);
                    formattedDeadline = deadline.toISOString().slice(0, 16);
                }
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
                const existingModal = document.getElementById('customEditModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // –°–æ–∑–¥–∞–µ–º –ö–ê–°–¢–û–ú–ù–û–ï –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ê–ë–°–û–õ–Æ–¢–ù–´–ú —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                const modalHTML = `
                    <div id="customEditModal" style="
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        background: rgba(0, 0, 0, 0.6) !important;
                        z-index: 999999 !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                    " onclick="if(event.target.id === 'customEditModal') hideEditModal()">
                        <div style="
                            background: white !important;
                            border-radius: 8px !important;
                            width: 90% !important;
                            max-width: 800px !important;
                            max-height: 90vh !important;
                            display: flex !important;
                            flex-direction: column !important;
                            position: relative !important;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
                        " onclick="event.stopPropagation()">
                            <div style="
                                padding: 20px !important;
                                border-bottom: 1px solid #dee2e6 !important;
                                display: flex !important;
                                justify-content: space-between !important;
                                align-items: center !important;
                                flex-shrink: 0 !important;
                            ">
                                <h4 style="margin: 0 !important; color: #333 !important;">
                                    <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
                                </h4>
                                <button onclick="hideEditModal()" style="
                                    background: none !important;
                                    border: none !important;
                                    font-size: 28px !important;
                                    line-height: 1 !important;
                                    cursor: pointer !important;
                                    color: #6c757d !important;
                                    padding: 0 !important;
                                    width: 30px !important;
                                    height: 30px !important;
                                ">&times;</button>
                            </div>
                            <div style="
                                padding: 20px !important;
                                overflow-y: auto !important;
                                flex-grow: 1 !important;
                            ">
                                <form id="editProjectForm">
                                    <input type="hidden" id="editProjectId" value="${project.id}">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="editProjectTitle" value="${(project.title || '').replace(/"/g, '&quot;')}" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞</label>
                                            <select class="form-select" id="editProjectType">
                                                <option value="website" ${project.project_type === 'website' ? 'selected' : ''}>–í–µ–±-—Å–∞–π—Ç</option>
                                                <option value="bot" ${project.project_type === 'bot' ? 'selected' : ''}>Telegram-–±–æ—Ç</option>
                                                <option value="app" ${project.project_type === 'app' ? 'selected' : ''}>–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</option>
                                                <option value="other" ${project.project_type === 'other' ? 'selected' : ''}>–î—Ä—É–≥–æ–µ</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                        <textarea class="form-control" id="editProjectDescription" rows="3">${project.description || ''}</textarea>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                            <select class="form-select" id="editProjectStatus">
                                                <option value="new" ${project.status === 'new' ? 'selected' : ''}>–ù–æ–≤—ã–π</option>
                                                <option value="review" ${project.status === 'review' ? 'selected' : ''}>–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                                                <option value="accepted" ${project.status === 'accepted' ? 'selected' : ''}>–ü—Ä–∏–Ω—è—Ç</option>
                                                <option value="in_progress" ${project.status === 'in_progress' ? 'selected' : ''}>–í —Ä–∞–±–æ—Ç–µ</option>
                                                <option value="testing" ${project.status === 'testing' ? 'selected' : ''}>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                                                <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                                <option value="cancelled" ${project.status === 'cancelled' ? 'selected' : ''}>–û—Ç–º–µ–Ω–µ–Ω</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                                            <select class="form-select" id="editProjectComplexity">
                                                <option value="simple" ${project.complexity === 'simple' ? 'selected' : ''}>–ü—Ä–æ—Å—Ç–æ–π</option>
                                                <option value="medium" ${project.complexity === 'medium' ? 'selected' : ''}>–°—Ä–µ–¥–Ω–∏–π</option>
                                                <option value="complex" ${project.complexity === 'complex' ? 'selected' : ''}>–°–ª–æ–∂–Ω—ã–π</option>
                                                <option value="premium" ${project.complexity === 'premium' ? 'selected' : ''}>–ü—Ä–µ–º–∏—É–º</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                                            <select class="form-select" id="editProjectPriority">
                                                <option value="low" ${project.priority === 'low' ? 'selected' : ''}>–ù–∏–∑–∫–∏–π</option>
                                                <option value="normal" ${project.priority === 'normal' ? 'selected' : ''}>–û–±—ã—á–Ω—ã–π</option>
                                                <option value="high" ${project.priority === 'high' ? 'selected' : ''}>–í—ã—Å–æ–∫–∏–π</option>
                                                <option value="urgent" ${project.priority === 'urgent' ? 'selected' : ''}>–°—Ä–æ—á–Ω—ã–π</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectEstimatedCost" value="${project.estimated_cost || ''}" step="100">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectExecutorCost" value="${project.executor_cost || ''}" step="100">
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</label>
                                            <select class="form-select" id="editProjectAssignedExecutor">
                                                ${executorsOptions}
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–î–µ–¥–ª–∞–π–Ω</label>
                                            <input type="datetime-local" class="form-control" id="editProjectDeadline" value="${formattedDeadline}">
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectPrepaymentAmount" value="${project.prepayment_amount || ''}" step="100">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–û–ø–ª–∞—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectClientPaidTotal" value="${project.client_paid_total || ''}" step="100">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">–í—ã–ø–ª–∞—á–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectExecutorPaidTotal" value="${project.executor_paid_total || ''}" step="100">
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                                            <input type="number" class="form-control" id="editProjectFinalCost" value="${project.final_cost || ''}" step="100">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–û—Ü–µ–Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è (—á–∞—Å—ã)</label>
                                            <input type="number" class="form-control" id="editProjectEstimatedHours" value="${project.estimated_hours || ''}" min="1">
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div style="
                                padding: 20px !important;
                                border-top: 1px solid #dee2e6 !important;
                                display: flex !important;
                                justify-content: flex-end !important;
                                gap: 10px !important;
                                flex-shrink: 0 !important;
                            ">
                                <button onclick="hideEditModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                                <button onclick="submitProjectEdit()" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
                if (project.assigned_executor_id) {
                    document.getElementById('editProjectAssignedExecutor').value = project.assigned_executor_id;
                }
                
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message, 'danger');
        }
    }
    
    function hideEditModal() {
        const modal = document.getElementById('customEditModal');
        if (modal) {
            modal.remove();
        }
    }

    async function submitProjectEdit() {
        const projectId = document.getElementById('editProjectId').value;
        const title = document.getElementById('editProjectTitle').value;
        const description = document.getElementById('editProjectDescription').value;
        const projectType = document.getElementById('editProjectType').value;
        const status = document.getElementById('editProjectStatus').value;
        const complexity = document.getElementById('editProjectComplexity').value;
        const priority = document.getElementById('editProjectPriority').value;
        const estimatedCost = document.getElementById('editProjectEstimatedCost').value;
        const executorCost = document.getElementById('editProjectExecutorCost').value;
        const finalCost = document.getElementById('editProjectFinalCost').value;
        const estimatedHours = document.getElementById('editProjectEstimatedHours').value;
        const prepaymentAmount = document.getElementById('editProjectPrepaymentAmount').value;
        const clientPaidTotal = document.getElementById('editProjectClientPaidTotal').value;
        const executorPaidTotal = document.getElementById('editProjectExecutorPaidTotal').value;
        const assignedExecutor = document.getElementById('editProjectAssignedExecutor').value;
        const deadline = document.getElementById('editProjectDeadline').value;
        
        if (!title.trim()) {
            showNotification('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ', 'warning');
            return;
        }
        
        try {
            const response = await fetch(`/admin/api/projects/${projectId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                },
                body: JSON.stringify({
                    title: title.trim(),
                    description: description.trim(),
                    project_type: projectType,
                    status: status,
                    complexity: complexity,
                    priority: priority,
                    estimated_cost: estimatedCost ? parseFloat(estimatedCost) : null,
                    executor_cost: executorCost ? parseFloat(executorCost) : null,
                    final_cost: finalCost ? parseFloat(finalCost) : null,
                    estimated_hours: estimatedHours ? parseInt(estimatedHours) : null,
                    prepayment_amount: prepaymentAmount ? parseFloat(prepaymentAmount) : null,
                    client_paid_total: clientPaidTotal ? parseFloat(clientPaidTotal) : null,
                    executor_paid_total: executorPaidTotal ? parseFloat(executorPaidTotal) : null,
                    assigned_executor_id: assignedExecutor || null,
                    deadline: deadline || null
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                hideEditModal();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message, 'danger');
        }
    }

    async function contactClient(telegramId) {
        if (!telegramId) {
            showNotification('Telegram ID –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω', 'warning');
            return;
        }
        
        const message = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:');
        if (!message || !message.trim()) {
            return;
        }
        
        try {
            const response = await fetch('/admin/api/send-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa(`${username}:${password}`)
                },
                body: JSON.stringify({
                    telegram_id: telegramId,
                    message: message.trim()
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É!', 'success');
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'danger');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + error.message, 'danger');
        }
    }

    function showCreateProjectModal() {
        console.log('–§—É–Ω–∫—Ü–∏—è showCreateProjectModal –≤—ã–∑–≤–∞–Ω–∞');
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
        const existingModal = document.getElementById('customCreateModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // –°–æ–∑–¥–∞–µ–º –ö–ê–°–¢–û–ú–ù–û–ï –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        const modalHTML = `
            <div id="customCreateModal" style="
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.6) !important;
                z-index: 999999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                overflow: hidden !important;
            " onclick="if(event.target.id === 'customCreateModal') hideCreateProjectModal()">
                <div style="
                    background: white !important;
                    border-radius: 8px !important;
                    width: 90% !important;
                    max-width: 800px !important;
                    max-height: 90vh !important;
                    display: flex !important;
                    flex-direction: column !important;
                    position: relative !important;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
                " onclick="event.stopPropagation()">
                    <div style="
                        padding: 20px !important;
                        border-bottom: 1px solid #dee2e6 !important;
                        display: flex !important;
                        justify-content: space-between !important;
                        align-items: center !important;
                        flex-shrink: 0 !important;
                    ">
                        <h4 style="margin: 0 !important; color: #333 !important;">
                            <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
                        </h4>
                        <button onclick="hideCreateProjectModal()" style="
                            background: none !important;
                            border: none !important;
                            font-size: 28px !important;
                            line-height: 1 !important;
                            cursor: pointer !important;
                            color: #6c757d !important;
                            padding: 0 !important;
                            width: 30px !important;
                            height: 30px !important;
                        ">&times;</button>
                    </div>
                    <div style="
                        padding: 20px !important;
                        overflow-y: auto !important;
                        flex-grow: 1 !important;
                    ">
                        <form id="createProjectForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="createProjectTitle" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞</label>
                                        <select class="form-select" id="createProjectType">
                                            <option value="website">–í–µ–±-—Å–∞–π—Ç</option>
                                            <option value="bot">Telegram-–±–æ—Ç</option>
                                            <option value="app">–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</option>
                                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="createProjectDescription" rows="3" required placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –ø—Ä–æ–µ–∫—Ç..."></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                                        <input type="text" class="form-control" id="createClientName" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Telegram ID –∫–ª–∏–µ–Ω—Ç–∞</label>
                                        <input type="text" class="form-control" id="createClientTelegramId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
                                        <input type="text" class="form-control" id="createClientPhone" placeholder="+7 (999) 123-45-67">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                                        <select class="form-select" id="createProjectComplexity">
                                            <option value="simple">–ü—Ä–æ—Å—Ç–æ–π</option>
                                            <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                            <option value="complex">–°–ª–æ–∂–Ω—ã–π</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                                        <select class="form-select" id="createProjectPriority">
                                            <option value="low">–ù–∏–∑–∫–∏–π</option>
                                            <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                            <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                                            <option value="urgent">–°—Ä–æ—á–Ω—ã–π</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                        <select class="form-select" id="createProjectStatus">
                                            <option value="new" selected>–ù–æ–≤—ã–π</option>
                                            <option value="review">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                                            <option value="accepted">–ü—Ä–∏–Ω—è—Ç</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                                        <input type="number" class="form-control" id="createEstimatedCost" min="0" step="1000" placeholder="50000">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (‚ÇΩ)</label>
                                        <input type="number" class="form-control" id="createExecutorCost" min="0" step="500" placeholder="30000">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–ß–∞—Å—ã (–ø—Ä–æ–≥–Ω–æ–∑)</label>
                                        <input type="number" class="form-control" id="createEstimatedHours" min="1" step="1" placeholder="40">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–ª—è -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                                        <input type="number" class="form-control" id="createPrepaymentAmount" min="0" step="1000" placeholder="0">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–£–∂–µ –∑–∞–ø–ª–∞—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–º (‚ÇΩ)</label>
                                        <input type="number" class="form-control" id="createClientPaidTotal" min="0" step="1000" placeholder="0">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">–í—ã–ø–ª–∞—á–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é (‚ÇΩ)</label>
                                        <input type="number" class="form-control" id="createExecutorPaidTotal" min="0" step="500" placeholder="0">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏ –¥–∞—Ç—ã -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</label>
                                        <select class="form-select" id="createAssignedExecutor">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                                            <option value="1">admin (owner)</option>
                                            <option value="2">–ù–∏–∫–æ–ª–∞–µ–≤ –ù–∏–∫–æ–ª–∞–π (executor)</option>
                                            <option value="3">–ú–∏—à–∞ –ö–ª—é—á–∫–∞ (executor)</option>
                                            <option value="4">–î–∞–Ω–∏–∏–ª –ú–∏—Ö–∞–π–ª–æ–≤ (executor)</option>
                                            <option value="5">–ü–∞–≤–µ–ª (executor)</option>
                                            <option value="6">–¢–µ—Å—Ç–æ–≤—ã–π –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (executor)</option>
                                            <option value="7">–ì–µ–Ω–Ω–∞–¥–∏–π –ù–∏–∫–æ–ª–∞–µ–≤ (executor)</option>
                                            <option value="8">–ò–≤–∞–Ω –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (executor)</option>
                                            <option value="9">–ü–µ—Ç—Ä –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (executor)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–î–µ–¥–ª–∞–π–Ω</label>
                                        <input type="date" class="form-control" id="createDeadline">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">–¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
                                        <input type="text" class="form-control" id="createBotToken" placeholder="–¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</label>
                                        <input type="text" class="form-control" id="createChatId" placeholder="ID —á–∞—Ç–∞ –∏–ª–∏ –∫–∞–Ω–∞–ª–∞">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</label>
                                <textarea class="form-control" id="createTechnicalRequirements" rows="3" placeholder="–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ..."></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</label>
                                <textarea class="form-control" id="createAdditionalRequirements" rows="2" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div style="
                        padding: 20px !important;
                        border-top: 1px solid #dee2e6 !important;
                        display: flex !important;
                        justify-content: flex-end !important;
                        gap: 10px !important;
                        flex-shrink: 0 !important;
                    ">
                        <button onclick="hideCreateProjectModal()" class="btn btn-secondary">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="createProject()" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.body.style.overflow = 'hidden';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        setTimeout(async () => {
            console.log('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π...');
            try {
                const response = await fetch('/admin/api/users/executors', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                    }
                });
                
                console.log('–û—Ç–≤–µ—Ç –æ—Ç API –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏:', data);
                    
                    const executorSelect = document.getElementById('createAssignedExecutor');
                    
                    if (executorSelect) {
                        // –ù–ï –æ—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å
                        if (executorSelect.children.length <= 1) {
                            executorSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>';
                        }
                        
                        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å API, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π
                        if (executorSelect.children.length <= 1) {
                            if (data.executors && data.executors.length > 0) {
                                data.executors.forEach(executor => {
                                    const option = document.createElement('option');
                                    option.value = executor.id;
                                    const name = executor.first_name || executor.username || '–ë–µ–∑ –∏–º–µ–Ω–∏';
                                    const role = executor.role || 'executor';
                                    option.textContent = `${name} (${role})`;
                                    executorSelect.appendChild(option);
                                });
                                console.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${data.executors.length} –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –≤ —Å–ø–∏—Å–æ–∫`);
                            } else {
                                console.warn('–°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ø—É—Å—Ç');
                            }
                        } else {
                            console.log('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ HTML');
                        }
                    } else {
                        console.error('–≠–ª–µ–º–µ–Ω—Ç select –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:', response.status);
                }
            } catch (error) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:', error);
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                const executorSelect = document.getElementById('createAssignedExecutor');
                if (executorSelect) {
                    executorSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>';
                    const option = document.createElement('option');
                    option.value = "1";
                    option.textContent = "admin (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)";
                    executorSelect.appendChild(option);
                }
            }
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
            const firstInput = document.getElementById('createProjectTitle');
            if (firstInput) {
                firstInput.focus();
            }
        }, 200);
    }
    
    function hideCreateProjectModal() {
        console.log('–ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
        const modal = document.getElementById('customCreateModal');
        if (modal) {
            modal.remove();
            document.body.style.overflow = '';
        }
    }

    window.createProject = async function() {
        console.log('–§—É–Ω–∫—Ü–∏—è createProject –≤—ã–∑–≤–∞–Ω–∞');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        const username = window.username;
        const password = window.password;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const titleElement = document.getElementById('createProjectTitle');
        const descriptionElement = document.getElementById('createProjectDescription');
        
        console.log('Title element:', titleElement);
        console.log('Description element:', descriptionElement);
        
        if (!titleElement || !descriptionElement) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
            showNotification('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'danger');
            return;
        }
        
        const title = titleElement.value;
        const description = descriptionElement.value;
        
        console.log('Title value:', title);
        console.log('Description value:', description);
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const getElementValue = (id) => {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`–≠–ª–µ–º–µ–Ω—Ç —Å ID '${id}' –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return '';
            }
            return element.value;
        };
        
        const projectType = getElementValue('createProjectType');
        const clientName = getElementValue('createClientName');
        const clientTelegramId = getElementValue('createClientTelegramId');
        const clientPhone = getElementValue('createClientPhone');
        const complexity = getElementValue('createProjectComplexity');
        const priority = getElementValue('createProjectPriority');
        const status = getElementValue('createProjectStatus');
        const estimatedCost = getElementValue('createEstimatedCost');
        const executorCost = getElementValue('createExecutorCost');
        const estimatedHours = getElementValue('createEstimatedHours');
        const deadline = getElementValue('createDeadline'); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω ID
        
        // –ù–æ–≤—ã–µ –ø–æ–ª—è
        const prepaymentAmount = getElementValue('createPrepaymentAmount');
        const clientPaidTotal = getElementValue('createClientPaidTotal');
        const executorPaidTotal = getElementValue('createExecutorPaidTotal');
        const assignedExecutor = getElementValue('createAssignedExecutor');
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        const botToken = getElementValue('createBotToken');
        
        if (!title.trim()) {
            showNotification('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ', 'warning');
            return;
        }
        
        if (!description.trim()) {
            showNotification('–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ', 'warning');
            return;
        }
        
        try {
            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞');
            console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', {
                title: title.trim(),
                description: description.trim(),
                project_type: projectType || 'bot',
                complexity: complexity || 'medium',
                priority: priority || 'medium',
                status: status || 'new'
            });
            
            const response = await fetch('/admin/api/projects/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa(`${username}:${password}`)
                },
                body: JSON.stringify({
                    title: title.trim(),
                    description: description.trim(),
                    project_type: projectType || 'bot',
                    client_name: clientName.trim(),
                    client_telegram_id: clientTelegramId.trim(),
                    client_phone: clientPhone.trim(),
                    complexity: complexity || 'medium',
                    priority: priority || 'medium',
                    status: status || 'new',
                    estimated_cost: estimatedCost ? parseFloat(estimatedCost) : null,
                    executor_cost: executorCost ? parseFloat(executorCost) : null,
                    estimated_hours: estimatedHours ? parseInt(estimatedHours) : null,
                    deadline: deadline || null,
                    prepayment_amount: prepaymentAmount ? parseFloat(prepaymentAmount) : 0,
                    client_paid_total: clientPaidTotal ? parseFloat(clientPaidTotal) : 0,
                    executor_paid_total: executorPaidTotal ? parseFloat(executorPaidTotal) : 0,
                    assigned_executor_id: assignedExecutor ? parseInt(assignedExecutor) : null,
                    bot_token: botToken || null,
                    timeweb_login: null,
                    timeweb_password: null
                })
            });
            
            console.log('Response status:', response.status);
            const data = await response.json();
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
            if (data.success) {
                showNotification('–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                
                hideCreateProjectModal();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message, 'danger');
        }
    }

    function editCurrentProject() {
        if (currentProjectId) {
            openEditModal(currentProjectId);
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('projectModal'));
            if (modal) {
                modal.hide();
            }
        }
    }

    function refreshProjects() {
        window.location.reload();
    }

    async function exportProjects() {
        try {
            const response = await fetch('/admin/api/projects/export', {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `projects_export_${new Date().toISOString().split('T')[0]}.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                showNotification('–≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤', 'danger');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message, 'danger');
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
    async function confirmStatusChange() {
        const projectId = document.getElementById('changeStatusProjectId').value;
        const useCustom = document.getElementById('useCustomStatus').checked;
        const comment = document.getElementById('changeStatusComment').value;
        let statusId = null;
        
        if (useCustom) {
            const customName = document.getElementById('customStatusName').value.trim();
            if (!customName) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞', 'warning');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
            try {
                const response = await fetch('/admin/api/project-statuses/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Basic ' + btoa(`${username}:${password}`)
                    },
                    body: JSON.stringify({ name: customName })
                });
                
                const data = await response.json();
                if (data.success) {
                    statusId = data.data.id;
                    projectStatuses.push(data.data);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'danger');
                    return;
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ' + error.message, 'danger');
                return;
            }
        } else {
            statusId = document.getElementById('changeStatusNewStatus').value;
        }
        
        if (!statusId) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å', 'warning');
            return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
        try {
            const response = await fetch(`/admin/api/projects/${projectId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa(`${username}:${password}`)
                },
                body: JSON.stringify({ status_id: statusId, comment })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!', 'success');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modal = bootstrap.Modal.getInstance(document.getElementById('changeStatusModal'));
                modal.hide();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'danger');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ' + error.message, 'danger');
        }
    }

    // –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ë–ï–ó Bootstrap
    async function viewProject(projectId) {
        try {
            const response = await fetch(`/admin/api/projects/${projectId}`, {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.success && data.project) {
                const project = data.project;
                currentProjectId = projectId;
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
                const existingModal = document.getElementById('customCenterModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                const modalContent = `
                    <div class="row">
                        <div class="col-md-8">
                            <h4>${project.title}</h4>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:</strong>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="expandTZ(this)">
                                        <i class="fas fa-expand-arrows-alt"></i> –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å
                                    </button>
                                </div>
                                <div class="description-container" style="max-height: 300px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 0.375rem; padding: 15px; background-color: #f8f9fa;">
                                    <div class="description-text" style="white-space: pre-wrap; font-size: 0.95rem; line-height: 1.5;">
                                        ${formatTechnicalSpecification(project) || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <strong>–°—Ç–∞—Ç—É—Å:</strong>
                                    <span class="badge status-${project.status} ms-2">${getStatusName(project.status)}</span>
                                </div>
                                <div class="col-md-6">
                                    <strong>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong>
                                    <span class="badge complexity-${project.complexity} ms-2">${project.complexity}</span>
                                </div>
                            </div>
                            
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${(project.estimated_cost || 0)}‚ÇΩ
                                    ${project.final_cost && project.final_cost != project.estimated_cost ? 
                                        `<br><small class="text-success">–§–∏–Ω–∞–ª—å–Ω–∞—è: ${project.final_cost}‚ÇΩ</small>` : ''}
                                </div>
                                <div class="col-md-6">
                                    <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${project.created_at ? new Date(project.created_at).toLocaleDateString() : '–ù/–î'}
                                    ${project.updated_at && project.updated_at != project.created_at ? 
                                        `<br><small class="text-muted">–û–±–Ω–æ–≤–ª–µ–Ω: ${new Date(project.updated_at).toLocaleDateString()}</small>` : ''}
                                </div>
                            </div>
                            
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <strong>–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞:</strong> ${project.project_type || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                                </div>
                                <div class="col-md-6">
                                    <strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> ${project.priority || '–û–±—ã—á–Ω—ã–π'}
                                </div>
                            </div>
                            
                            ${project.deadline ? `
                            <div class="row mt-2">
                                <div class="col-md-12">
                                    <strong>–î–µ–¥–ª–∞–π–Ω:</strong> <span class="text-warning">${new Date(project.deadline).toLocaleDateString()}</span>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${project.estimated_hours ? `
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <strong>–ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –≤—Ä–µ–º—è:</strong> ${project.estimated_hours}—á
                                </div>
                                <div class="col-md-6">
                                    <strong>–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏:</strong> ${project.actual_hours || 0}—á
                                </div>
                            </div>
                            ` : ''}
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ -->
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> 
                                    ${project.assigned_executor ? `
                                        <span class="badge bg-primary ms-2">
                                            ${project.assigned_executor.first_name || project.assigned_executor.username} 
                                            (${project.assigned_executor.role})
                                        </span>
                                    ` : '<span class="badge bg-secondary ms-2">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>'}
                                </div>
                            </div>
                            
                            ${project.user ? `
                            <div class="mt-4">
                                <h5><i class="fas fa-user me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑—á–∏–∫–µ</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="d-flex align-items-center mb-2">
                                                    <div class="user-avatar me-3">${(project.user.first_name || 'U')[0]}</div>
                                                    <div>
                                                        <div><strong>${project.user.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} ${project.user.last_name || ''}</strong></div>
                                                        <small class="text-muted">@${project.user.username || '–Ω–µ—Ç username'}</small>
                                                    </div>
                                                </div>
                                                
                                                <div class="row mt-2">
                                                    <div class="col-md-6">
                                                        <small class="text-muted">Telegram ID:</small><br>
                                                        <span class="badge bg-info">${project.user.telegram_id || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <small class="text-muted">–¢–µ–ª–µ—Ñ–æ–Ω:</small><br>
                                                        <span>${project.user.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="row mt-2">
                                                    <div class="col-md-6">
                                                        <small class="text-muted">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</small><br>
                                                        <span>${project.user.created_at ? new Date(project.user.created_at).toLocaleDateString() : '–ù/–î'}</span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <small class="text-muted">–°—Ç–∞—Ç—É—Å:</small><br>
                                                        <span class="badge ${project.user.is_active ? 'bg-success' : 'bg-secondary'}">${project.user.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 text-end">
                                                ${project.user.telegram_id ? `
                                                <button class="btn btn-outline-primary btn-sm" onclick="contactClient('${project.user.telegram_id}')">
                                                    <i class="fas fa-comment me-1"></i>–ù–∞–ø–∏—Å–∞—Ç—å
                                                </button>
                                                ` : ''}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                            
                            <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="mt-4">
                                <h5><i class="fas fa-cogs me-2"></i>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-robot me-2"></i>Telegram Bot</h6>
                                                ${project.bot_token ? `
                                                <div class="mb-2">
                                                    <small class="text-muted">–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</small><br>
                                                    <code class="text-break">${project.bot_token}</code>
                                                    <button class="btn btn-link btn-sm p-0 ms-2" onclick="copyToClipboard('${project.bot_token}')">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                                ` : '<p class="text-muted">–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω</p>'}
                                                
                                                ${project.user_telegram_id ? `
                                                <div class="mb-2">
                                                    <small class="text-muted">Telegram ID –∫–ª–∏–µ–Ω—Ç–∞:</small><br>
                                                    <code>${project.user_telegram_id}</code>
                                                    <button class="btn btn-link btn-sm p-0 ms-2" onclick="copyToClipboard('${project.user_telegram_id}')">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                                ` : ''}
                                                
                                                ${project.chat_id ? `
                                                <div class="mb-2">
                                                    <small class="text-muted">ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</small><br>
                                                    <code>${project.chat_id}</code>
                                                    <button class="btn btn-link btn-sm p-0 ms-2" onclick="copyToClipboard('${project.chat_id}')">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                                ` : ''}
                                            </div>
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-server me-2"></i>Timeweb</h6>
                                                ${project.timeweb && project.timeweb.has_credentials ? `
                                                <div class="mb-2">
                                                    <small class="text-muted">–õ–æ–≥–∏–Ω:</small><br>
                                                    <code>${project.timeweb.login || '–ù–µ —É–∫–∞–∑–∞–Ω'}</code>
                                                    ${project.timeweb.login ? `
                                                    <button class="btn btn-link btn-sm p-0 ms-2" onclick="copyToClipboard('${project.timeweb.login}')">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                    ` : ''}
                                                </div>
                                                ${project.timeweb.password ? `
                                                <div class="mb-2">
                                                    <small class="text-muted">–ü–∞—Ä–æ–ª—å:</small><br>
                                                    <code>${project.timeweb.password}</code>
                                                    <button class="btn btn-link btn-sm p-0 ms-2" onclick="copyToClipboard('${project.timeweb.password}')">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                                ` : ''}
                                                ` : '<p class="text-muted">–î–∞–Ω–Ω—ã–µ Timeweb –Ω–µ —É–∫–∞–∑–∞–Ω—ã</p>'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞</h6>
                                </div>
                                <div class="card-body">
                                    <div class="progress mb-2" style="height: 10px;">
                                        <div class="progress-bar" style="width: ${calculateProgress(project.status)}%"></div>
                                    </div>
                                    <small class="text-muted">${calculateProgress(project.status)}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // –°–æ–∑–¥–∞–µ–º –ü–û–õ–ù–û–°–¢–¨–Æ –ö–ê–°–¢–û–ú–ù–û–ï –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–µ–∑ Bootstrap
                const modalHTML = `
                    <div id="customCenterModal" style="
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        right: 0 !important;
                        bottom: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        background: rgba(0, 0, 0, 0.6) !important;
                        z-index: 999999 !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        overflow: hidden !important;
                    " onclick="if(event.target.id === 'customCenterModal') closeCustomModal()">
                        <div style="
                            background: white !important;
                            border-radius: 8px !important;
                            width: 90% !important;
                            max-width: 800px !important;
                            max-height: 90vh !important;
                            display: flex !important;
                            flex-direction: column !important;
                            position: relative !important;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
                        " onclick="event.stopPropagation()">
                            <div style="
                                padding: 20px !important;
                                border-bottom: 1px solid #dee2e6 !important;
                                display: flex !important;
                                justify-content: space-between !important;
                                align-items: center !important;
                                flex-shrink: 0 !important;
                            ">
                                <h4 style="margin: 0 !important; color: #333 !important;">–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ #${project.id}</h4>
                                <button onclick="closeCustomModal()" style="
                                    background: none !important;
                                    border: none !important;
                                    font-size: 28px !important;
                                    line-height: 1 !important;
                                    cursor: pointer !important;
                                    color: #6c757d !important;
                                    padding: 0 !important;
                                    width: 30px !important;
                                    height: 30px !important;
                                ">&times;</button>
                            </div>
                            <div style="
                                padding: 20px !important;
                                overflow-y: auto !important;
                                flex-grow: 1 !important;
                            ">
                                ${modalContent}
                            </div>
                            <div style="
                                padding: 20px !important;
                                border-top: 1px solid #dee2e6 !important;
                                display: flex !important;
                                justify-content: flex-end !important;
                                gap: 10px !important;
                                flex-shrink: 0 !important;
                            ">
                                <button onclick="editProject('${project.id}')" class="btn btn-primary">
                                    <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button onclick="closeCustomModal()" class="btn btn-secondary">
                                    –ó–∞–∫—Ä—ã—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                document.body.style.overflow = 'hidden';
            } else {
                console.error('–û—à–∏–±–∫–∞ API:', data);
                showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message, 'danger');
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function closeCustomModal() {
        const modal = document.getElementById('customCenterModal');
        if (modal) {
            modal.remove();
            document.body.style.overflow = '';
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–ª–∏–µ–Ω—Ç–æ–º




    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
    async function showFilesModal(projectId) {
        try {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingModal = document.getElementById('customFilesModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // –°–æ–∑–¥–∞–µ–º –ö–ê–°–¢–û–ú–ù–û–ï –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å –ê–ë–°–û–õ–Æ–¢–ù–´–ú —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            const modalHTML = `
                <div id="customFilesModal" style="
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    height: 100vh !important;
                    background: rgba(0, 0, 0, 0.6) !important;
                    z-index: 999999 !important;
                    display: flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                " onclick="if(event.target.id === 'customFilesModal') hideFilesModal()">
                    <div style="
                        background: white !important;
                        border-radius: 8px !important;
                        width: 90% !important;
                        max-width: 800px !important;
                        max-height: 90vh !important;
                        display: flex !important;
                        flex-direction: column !important;
                        position: relative !important;
                        box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
                    " onclick="event.stopPropagation()">
                        <div style="
                            padding: 20px !important;
                            border-bottom: 1px solid #dee2e6 !important;
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            flex-shrink: 0 !important;
                        ">
                            <h4 style="margin: 0 !important; color: #333 !important;">
                                <i class="fas fa-folder-open me-2"></i>–§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
                            </h4>
                            <button onclick="hideFilesModal()" style="
                                background: none !important;
                                border: none !important;
                                font-size: 28px !important;
                                line-height: 1 !important;
                                cursor: pointer !important;
                                color: #6c757d !important;
                                padding: 0 !important;
                                width: 30px !important;
                                height: 30px !important;
                            ">&times;</button>
                        </div>
                        <div style="
                            padding: 20px !important;
                            overflow-y: auto !important;
                            flex-grow: 1 !important;
                        ">
                            <div id="projectFilesContent">
                                <div class="text-center p-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <h6 class="mb-3">
                                <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª
                            </h6>
                            <form id="uploadFileForm" onsubmit="uploadProjectFile(event, ${projectId})">
                                <input type="hidden" id="uploadProjectId" value="${projectId}">
                                <div class="mb-3">
                                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
                                    <input type="file" class="form-control" id="projectFile" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</label>
                                    <textarea class="form-control" id="fileDescription" rows="2" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-upload me-1"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                                </button>
                            </form>
                        </div>
                        <div style="
                            padding: 20px !important;
                            border-top: 1px solid #dee2e6 !important;
                            display: flex !important;
                            justify-content: flex-end !important;
                            flex-shrink: 0 !important;
                        ">
                            <button onclick="hideFilesModal()" class="btn btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
            await loadProjectFiles(projectId);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–∞–π–ª–æ–≤:', error);
            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message, 'danger');
        }
    }
    
    function hideFilesModal() {
        const modal = document.getElementById('customFilesModal');
        if (modal) {
            modal.remove();
        }
    }

    async function loadProjectFiles(projectId) {
        try {
            const response = await fetch(`/admin/api/projects/${projectId}/files`, {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.success && data.files) {
                displayProjectFiles(data.files);
            } else {
                throw new Error(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:', error);
            const container = document.getElementById('projectFilesContent');
            container.innerHTML = `
                <div class="text-center p-4 text-muted">
                    <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ${error.message}</p>
                    <button class="btn btn-outline-primary btn-sm" onclick="loadProjectFiles(${projectId})">
                        <i class="fas fa-sync-alt me-1"></i>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                    </button>
                </div>
            `;
        }
    }

    function displayProjectFiles(files) {
        const container = document.getElementById('projectFilesContent');
        
        if (!files || files.length === 0) {
            container.innerHTML = `
                <div class="text-center p-4 text-muted">
                    <i class="fas fa-folder-open fa-2x mb-2"></i>
                    <p>–§–∞–π–ª—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    <small>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞</small>
                </div>
            `;
            return;
        }
        
        const filesHtml = files.map(file => `
            <div class="file-item d-flex align-items-center justify-content-between p-3 border rounded mb-2">
                <div class="d-flex align-items-center">
                    <div class="file-icon me-3">
                        ${getFileIcon(file.filename)}
                    </div>
                    <div>
                        <div class="fw-medium">${file.filename}</div>
                        <small class="text-muted">
                            ${formatFileSize(file.size)} ‚Ä¢ 
                            ${file.uploaded_at ? new Date(file.uploaded_at).toLocaleDateString() : '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}
                        </small>
                        ${file.description ? `<div class="text-muted small mt-1">${file.description}</div>` : ''}
                    </div>
                </div>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="downloadFile(${file.id})" title="–°–∫–∞—á–∞—Ç—å">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn btn-outline-danger" onclick="deleteFile(${file.id}, '${file.filename}')" title="–£–¥–∞–ª–∏—Ç—å">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = `
            <div class="files-list">
                <h6 class="mb-3">
                    <i class="fas fa-files me-2"></i>–§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ (${files.length})
                </h6>
                ${filesHtml}
            </div>
        `;
    }

    function getFileIcon(filename) {
        const extension = filename.split('.').pop().toLowerCase();
        const iconMap = {
            'pdf': '<i class="fas fa-file-pdf text-danger"></i>',
            'doc': '<i class="fas fa-file-word text-primary"></i>',
            'docx': '<i class="fas fa-file-word text-primary"></i>',
            'xls': '<i class="fas fa-file-excel text-success"></i>',
            'xlsx': '<i class="fas fa-file-excel text-success"></i>',
            'ppt': '<i class="fas fa-file-powerpoint text-warning"></i>',
            'pptx': '<i class="fas fa-file-powerpoint text-warning"></i>',
            'jpg': '<i class="fas fa-file-image text-info"></i>',
            'jpeg': '<i class="fas fa-file-image text-info"></i>',
            'png': '<i class="fas fa-file-image text-info"></i>',
            'gif': '<i class="fas fa-file-image text-info"></i>',
            'zip': '<i class="fas fa-file-archive text-secondary"></i>',
            'rar': '<i class="fas fa-file-archive text-secondary"></i>',
            'txt': '<i class="fas fa-file-alt text-muted"></i>',
            'py': '<i class="fas fa-file-code text-warning"></i>',
            'js': '<i class="fas fa-file-code text-warning"></i>',
            'html': '<i class="fas fa-file-code text-warning"></i>',
            'css': '<i class="fas fa-file-code text-warning"></i>'
        };
        return iconMap[extension] || '<i class="fas fa-file text-muted"></i>';
    }

    function formatFileSize(bytes) {
        if (!bytes) return '0 –ë';
        const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }

    async function uploadProjectFile() {
        const projectId = document.getElementById('uploadProjectId').value;
        const fileInput = document.getElementById('projectFileUpload');
        const description = document.getElementById('projectFileDescription').value;
        
        if (!fileInput.files.length) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'warning');
            return;
        }
        
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', projectId);
        if (description.trim()) {
            formData.append('description', description.trim());
        }
        
        try {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
            const uploadBtn = document.querySelector('button[onclick="uploadProjectFile()"]');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–ó–∞–≥—Ä—É–∑–∫–∞...';
            uploadBtn.disabled = true;
            
            const response = await fetch('/admin/api/projects/files/upload', {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                },
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                fileInput.value = '';
                document.getElementById('projectFileDescription').value = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                await loadProjectFiles(projectId);
            } else {
                throw new Error(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message, 'danger');
        } finally {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            const uploadBtn = document.querySelector('button[onclick="uploadProjectFile()"]');
            uploadBtn.innerHTML = originalText;
            uploadBtn.disabled = false;
        }
    }

    async function downloadFile(fileId) {
        try {
            const response = await fetch(`/admin/api/files/${fileId}/download`, {
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            const contentDisposition = response.headers.get('Content-Disposition');
            let filename = 'download';
            if (contentDisposition) {
                const filenameMatch = contentDisposition.match(/filename="(.+)"/);
                if (filenameMatch) {
                    filename = filenameMatch[1];
                }
            }
            
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'danger');
        }
    }

    async function deleteFile(fileId, filename) {
        if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª "${filename}"?`)) {
            return;
        }
        
        try {
            const response = await fetch(`/admin/api/files/${fileId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                const projectId = document.getElementById('uploadProjectId').value;
                await loadProjectFiles(projectId);
            } else {
                throw new Error(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'danger');
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
    function formatTechnicalSpecification(project) {
        // –ï—Å–ª–∏ –µ—Å—Ç—å structured_tz, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
        if (project.structured_tz && typeof project.structured_tz === 'object') {
            let formatted = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¢–ó
            if (project.structured_tz.title) {
                formatted += `üìã –ù–ê–ó–í–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê\n${project.structured_tz.title}\n\n`;
            }
            
            if (project.structured_tz.description) {
                formatted += `üìù –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê\n${project.structured_tz.description}\n\n`;
            }
            
            if (project.structured_tz.goals) {
                formatted += `üéØ –¶–ï–õ–ò –ò –ó–ê–î–ê–ß–ò\n${project.structured_tz.goals}\n\n`;
            }
            
            if (project.structured_tz.target_audience) {
                formatted += `üë• –¶–ï–õ–ï–í–ê–Ø –ê–£–î–ò–¢–û–†–ò–Ø\n${project.structured_tz.target_audience}\n\n`;
            }
            
            if (project.structured_tz.detailed_functions) {
                formatted += `‚öôÔ∏è –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø\n${project.structured_tz.detailed_functions}\n\n`;
            }
            
            if (project.structured_tz.technology_stack) {
                formatted += `üõ† –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö\n${project.structured_tz.technology_stack}\n\n`;
            }
            
            if (project.structured_tz.integrations) {
                formatted += `üîå –ò–ù–¢–ï–ì–†–ê–¶–ò–ò\n${project.structured_tz.integrations}\n\n`;
            }
            
            if (project.structured_tz.admin_panel_requirements) {
                formatted += `üëë –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨\n${project.structured_tz.admin_panel_requirements}\n\n`;
            }
            
            if (project.structured_tz.development_stages) {
                formatted += `üìÖ –≠–¢–ê–ü–´ –†–ê–ó–†–ê–ë–û–¢–ö–ò\n${project.structured_tz.development_stages}\n\n`;
            }
            
            if (project.structured_tz.risks_and_challenges) {
                formatted += `‚ö†Ô∏è –†–ò–°–ö–ò –ò –°–õ–û–ñ–ù–û–°–¢–ò\n${project.structured_tz.risks_and_challenges}\n\n`;
            }
            
            if (project.structured_tz.cost_breakdown) {
                formatted += `üí∞ –†–ê–°–ß–ï–¢ –°–¢–û–ò–ú–û–°–¢–ò\n${project.structured_tz.cost_breakdown}\n\n`;
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¢–ó, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
            if (project.structured_tz.tz_text) {
                formatted += `üìÑ –ü–û–õ–ù–û–ï –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï\n${project.structured_tz.tz_text}`;
            }
            
            return formatted;
        }
        
        // Fallback –∫ –æ–±—ã—á–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é
        return project.description || project.original_request || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –¢–ó –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
    function expandTZ(button) {
        const container = button.closest('.mb-3').querySelector('.description-container');
        const text = container.querySelector('.description-text').innerHTML;
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¢–ó
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">–ü–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div style="white-space: pre-wrap; font-size: 0.95rem; line-height: 1.5; max-height: 70vh; overflow-y: auto; padding: 15px; background-color: #f8f9fa; border-radius: 0.375rem;">
                            ${text}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-primary" onclick="copyToClipboard(this.closest('.modal').querySelector('.modal-body').textContent.trim())">
                            <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        // –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
        modal.addEventListener('hidden.bs.modal', () => {
            document.body.removeChild(modal);
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showNotification('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        }).catch(err => {
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            } catch (err) {
                showNotification('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'danger');
            }
            document.body.removeChild(textArea);
        });
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
    window.confirmDeleteProject = function(projectId, projectTitle) {
        console.log('confirmDeleteProject –≤—ã–∑–≤–∞–Ω —Å ID:', projectId, '–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º:', projectTitle);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ projectId –ø–µ—Ä–µ–¥–∞–Ω
        if (!projectId) {
            console.error('Project ID –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ confirmDeleteProject!');
            showNotification('–û—à–∏–±–∫–∞: ID –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω', 'danger');
            return;
        }
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
        const existingModal = document.getElementById('customDeleteModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
        const safeTitle = (projectTitle || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        
        // –°–æ–∑–¥–∞–µ–º –ö–ê–°–¢–û–ú–ù–û–ï –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å –ê–ë–°–û–õ–Æ–¢–ù–´–ú —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        const modalHTML = `
            <div id="customDeleteModal" style="
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.6) !important;
                z-index: 999999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            " onclick="if(event.target.id === 'customDeleteModal') hideDeleteModal()">
                <div style="
                    background: white !important;
                    border-radius: 8px !important;
                    width: 90% !important;
                    max-width: 500px !important;
                    position: relative !important;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
                " onclick="event.stopPropagation()">
                    <div style="
                        padding: 20px !important;
                        border-bottom: 1px solid #dee2e6 !important;
                        display: flex !important;
                        justify-content: space-between !important;
                        align-items: center !important;
                    ">
                        <h4 style="margin: 0 !important; color: #dc3545 !important;">
                            <i class="fas fa-exclamation-triangle me-2"></i>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                        </h4>
                        <button onclick="hideDeleteModal()" style="
                            background: none !important;
                            border: none !important;
                            font-size: 28px !important;
                            line-height: 1 !important;
                            cursor: pointer !important;
                            color: #6c757d !important;
                            padding: 0 !important;
                            width: 30px !important;
                            height: 30px !important;
                        ">&times;</button>
                    </div>
                    <div style="padding: 20px !important;">
                        <div class="alert alert-danger d-flex align-items-center">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <div>
                                <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.
                            </div>
                        </div>
                        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç <strong>"${safeTitle}"</strong>?</p>
                        <p class="text-muted">–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∞–Ω–Ω—ã–µ. –ó–∞–∫–∞–∑—á–∏–∫ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏.</p>
                        <input type="hidden" id="deleteProjectId" value="${projectId}">
                    </div>
                    <div style="
                        padding: 20px !important;
                        border-top: 1px solid #dee2e6 !important;
                        display: flex !important;
                        justify-content: flex-end !important;
                        gap: 10px !important;
                    ">
                        <button onclick="hideDeleteModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                        <button id="confirmDeleteBtn" class="btn btn-danger">
                            <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
        const checkElement = document.getElementById('deleteProjectId');
        if (checkElement) {
            console.log('–≠–ª–µ–º–µ–Ω—Ç deleteProjectId —Å–æ–∑–¥–∞–Ω —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º:', checkElement.value);
        } else {
            console.error('–≠–ª–µ–º–µ–Ω—Ç deleteProjectId –ù–ï —Å–æ–∑–¥–∞–Ω!');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
        setTimeout(() => {
            const deleteBtn = document.getElementById('confirmDeleteBtn');
            if (deleteBtn) {
                deleteBtn.onclick = function(e) {
                    e.preventDefault();
                    window.deleteProject();
                };
            }
        }, 100);
    }
    
    window.hideDeleteModal = function() {
        const modal = document.getElementById('customDeleteModal');
        if (modal) {
            modal.remove();
        }
    }

    window.deleteProject = async function() {
        // –ü–æ–ª—É—á–∞–µ–º ID –ø—Ä–æ–µ–∫—Ç–∞
        const projectIdElement = document.getElementById('deleteProjectId');
        if (!projectIdElement || !projectIdElement.value) {
            return; // –ü—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–µ
        }
        
        const projectId = projectIdElement.value;
        console.log('–£–¥–∞–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç —Å ID:', projectId);
        
        try {
            const response = await fetch(`/admin/api/projects/${projectId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Basic ' + btoa(`${window.username}:${window.password}`)
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                hideDeleteModal();
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞', 'danger');
        }
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞
    window.testFunction = function() {
        alert('–¢–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!');
        console.log('–¢–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!');
    };
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    window.username = 'admin';
    window.password = 'qwerty123';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    document.addEventListener('hidden.bs.modal', function (event) {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const scrollY = document.body.style.top;
        document.body.style.position = '';
        document.body.style.top = '';
        document.body.style.width = '';
        if (scrollY) {
            window.scrollTo(0, parseInt(scrollY || '0') * -1);
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω!');
        const createBtn = document.getElementById('createProjectBtn');
        console.log('–ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞:', createBtn);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ - —Ç—Ä–æ–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        if (createBtn) {
            // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
            createBtn.addEventListener('mousedown', function(e) {
                console.log('MOUSEDOWN –Ω–∞ –∫–Ω–æ–ø–∫–µ!');
            });
            
            createBtn.addEventListener('mouseup', function(e) {
                console.log('MOUSEUP –Ω–∞ –∫–Ω–æ–ø–∫–µ!');
            });
            
            createBtn.addEventListener('mouseover', function(e) {
                console.log('MOUSEOVER –Ω–∞ –∫–Ω–æ–ø–∫–µ!');
            });
            
            // 1. addEventListener –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
            createBtn.addEventListener('click', function(e) {
                console.log('–ö–õ–ò–ö —á–µ—Ä–µ–∑ addEventListener!');
                e.preventDefault();
                e.stopPropagation();
                createProject();
            });
            
            // 2. –ü—Ä—è–º–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ onclick –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
            createBtn.onclick = function(e) {
                console.log('–ö–õ–ò–ö —á–µ—Ä–µ–∑ onclick!');
                e.preventDefault();
                e.stopPropagation();
                createProject();
            };
            
            console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
        }
    });

</script>
</div> <!-- content-wrapper -->
{% endblock %}