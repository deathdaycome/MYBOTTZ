#!/bin/bash

# üö® –°–ö–†–ò–ü–¢ –°–†–û–ß–ù–û–ì–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –ë–û–¢–ê
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: bash QUICK_FIX.sh

echo "üö® –ù–ê–ß–ò–ù–ê–ï–ú –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ë–û–¢–ê..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/bot_business_card

echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –∏–∑ GitHub..."
git fetch origin

echo "üîÑ –ñ–ï–°–¢–ö–ò–ô –°–ë–†–û–° - —É–¥–∞–ª—è–µ–º –≤—Å–µ –ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git reset --hard origin/main

echo "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)..."
source venv/bin/activate
pip install -r requirements.txt --quiet

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —á–µ—Ä–µ–∑ PM2..."
pm2 restart bot-business-card

echo "‚è≥ –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã..."
sleep 3

echo "üìã –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å—Ç—Ä–æ–∫)..."
pm2 logs bot-business-card --lines 30 --nostream

echo ""
echo "‚úÖ –ì–û–¢–û–í–û!"
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞ –≤ Telegram: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start"
echo ""
echo "‚ö†Ô∏è  –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–ú–ï–ù–ò–¢–ï –ü–ê–†–û–õ–¨ –ê–î–ú–ò–ù–ö–ò!"
echo "   nano /var/www/bot_business_card/.env"
echo "   –ù–∞–π–¥–∏—Ç–µ ADMIN_PASSWORD –∏ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
